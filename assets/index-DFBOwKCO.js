var e,t,n,i,r,s,o,a,l,h,u,d,c,p,f,m,g,w,A,v,y,V,x,E,b,S=Object.defineProperty,R=(e,t,n)=>((e,t,n)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var M=Object.defineProperty,k=(e,t)=>M(e,"name",{value:t,configurable:!0}),T=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var n=t.length,i=new Uint8Array(3*(n-("="==t[n-1])-("="==t[n-2]))/4|0),r=0,s=0;r<n;){var o=e[t.charCodeAt(r++)],a=e[t.charCodeAt(r++)],l=e[t.charCodeAt(r++)],h=e[t.charCodeAt(r++)];i[s++]=o<<2|a>>4,i[s++]=a<<4|l>>2,i[s++]=l<<6|h}return i}})();function I(e){return e*Math.PI/180}function B(e){return 180*e/Math.PI}function P(e,t,n){return t>n?P(e,n,t):Math.min(Math.max(e,t),n)}function F(e,t,n){if("number"==typeof e&&"number"==typeof t)return e+(t-e)*n;if(e instanceof U&&t instanceof U)return e.lerp(t,n);if(e instanceof N&&t instanceof N)return e.lerp(t,n);throw new Error(`Bad value for lerp(): ${e}, ${t}. Only number, Vec2 and Color is supported.`)}function C(e,t,n,i,r){return i+(e-t)/(n-t)*(r-i)}function D(e,t,n,i,r){return P(C(e,t,n,i,r),i,r)}k(I,"deg2rad"),k(B,"rad2deg"),k(P,"clamp"),k(F,"lerp"),k(C,"map"),k(D,"mapc");var U=(k(e=class{constructor(e=0,t=e){R(this,"x",0),R(this,"y",0),this.x=e,this.y=t}static fromAngle(t){let n=I(t);return new e(Math.cos(n),Math.sin(n))}clone(){return new e(this.x,this.y)}add(...t){let n=L(...t);return new e(this.x+n.x,this.y+n.y)}sub(...t){let n=L(...t);return new e(this.x-n.x,this.y-n.y)}scale(...t){let n=L(...t);return new e(this.x*n.x,this.y*n.y)}dist(...e){let t=L(...e);return this.sub(t).len()}sdist(...e){let t=L(...e);return this.sub(t).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let t=this.len();return 0===t?new e(0):this.scale(1/t)}normal(){return new e(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let t=L(...e);return B(Math.atan2(this.y-t.y,this.x-t.x))}angleBetween(...e){let t=L(...e);return B(Math.atan2(this.cross(t),this.dot(t)))}lerp(t,n){return new e(F(this.x,t.x,n),F(this.y,t.y,n))}slerp(e,t){let n=this.dot(e),i=this.cross(e),r=Math.atan2(i,n);return this.scale(Math.sin((1-t)*r)).add(e.scale(Math.sin(t*r))).scale(1/i)}isZero(){return 0===this.x&&0===this.y}toFixed(t){return new e(Number(this.x.toFixed(t)),Number(this.y.toFixed(t)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new ue(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}},"Vec2"),R(e,"LEFT",new e(-1,0)),R(e,"RIGHT",new e(1,0)),R(e,"UP",new e(0,-1)),R(e,"DOWN",new e(0,1)),e);function L(...e){if(1===e.length){if(e[0]instanceof U)return new U(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return new U(...e[0])}return new U(...e)}k(L,"vec2");var N=(t=class{constructor(e,t,n){R(this,"r",255),R(this,"g",255),R(this,"b",255),this.r=P(e,0,255),this.g=P(t,0,255),this.b=P(n,0,255)}static fromArray(e){return new t(e[0],e[1],e[2])}static fromHex(e){if("number"==typeof e)return new t(e>>16&255,e>>8&255,255&e);if("string"==typeof e){let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new t(parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16))}throw new Error("Invalid hex color format")}static fromHSL(e,n,i){if(0==n)return new t(255*i,255*i,255*i);let r=k(((e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e)),"hue2rgb"),s=i<.5?i*(1+n):i+n-i*n,o=2*i-s,a=r(o,s,e+1/3),l=r(o,s,e),h=r(o,s,e-1/3);return new t(Math.round(255*a),Math.round(255*l),Math.round(255*h))}clone(){return new t(this.r,this.g,this.b)}lighten(e){return new t(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(e){return new t(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,n){return new t(F(this.r,e.r,n),F(this.g,e.g,n),F(this.b,e.b,n))}toHSL(){let e=this.r/255,t=this.g/255,n=this.b/255,i=Math.max(e,t,n),r=Math.min(e,t,n),s=(i+r)/2,o=s,a=s;if(i==r)s=o=0;else{let l=i-r;switch(o=a>.5?l/(2-i-r):l/(i+r),i){case e:s=(t-n)/l+(t<n?6:0);break;case t:s=(n-e)/l+2;break;case n:s=(e-t)/l+4}s/=6}return[s,o,a]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}},k(t,"Color"),R(t,"RED",new t(255,0,0)),R(t,"GREEN",new t(0,255,0)),R(t,"BLUE",new t(0,0,255)),R(t,"YELLOW",new t(255,255,0)),R(t,"MAGENTA",new t(255,0,255)),R(t,"CYAN",new t(0,255,255)),R(t,"WHITE",new t(255,255,255)),R(t,"BLACK",new t(0,0,0)),t);function G(...e){if(0===e.length)return new N(255,255,255);if(1===e.length){if(e[0]instanceof N)return e[0].clone();if("string"==typeof e[0])return N.fromHex(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return N.fromArray(e[0])}return new N(...e)}k(G,"rgb");var O=k(((e,t,n)=>N.fromHSL(e,t,n)),"hsl2rgb"),q=(k(n=class{constructor(e,t,n,i){R(this,"x",0),R(this,"y",0),R(this,"w",1),R(this,"h",1),this.x=e,this.y=t,this.w=n,this.h=i}scale(e){return new n(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new U(this.x,this.y)}clone(){return new n(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}},"Quad"),n);function H(e,t,n,i){return new q(e,t,n,i)}k(H,"quad");var j=(k(i=class{constructor(e){R(this,"m",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e&&(this.m=e)}static translate(e){return new i([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new i([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=I(-e);let t=Math.cos(e),n=Math.sin(e);return new i([1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1])}static rotateY(e){e=I(-e);let t=Math.cos(e),n=Math.sin(e);return new i([t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1])}static rotateZ(e){e=I(-e);let t=Math.cos(e),n=Math.sin(e);return new i([t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=I(-e);let t=Math.cos(e),n=Math.sin(e),i=this.m[0],r=this.m[1],s=this.m[4],o=this.m[5];return this.m[0]=i*t+r*n,this.m[1]=-i*n+r*t,this.m[4]=s*t+o*n,this.m[5]=-s*n+o*t,this}mult(e){let t=[];for(let n=0;n<4;n++)for(let i=0;i<4;i++)t[4*n+i]=this.m[0+i]*e.m[4*n+0]+this.m[4+i]*e.m[4*n+1]+this.m[8+i]*e.m[4*n+2]+this.m[12+i]*e.m[4*n+3];return new i(t)}multVec2(e){return new U(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new U(this.m[12],this.m[13])}getScale(){if(0!=this.m[0]||0!=this.m[1]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new U(t,e/t)}if(0!=this.m[4]||0!=this.m[5]){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],t=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new U(e/t,t)}return new U(0,0)}getRotation(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return B(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return B(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}return 0}getSkew(){if(0!=this.m[0]||0!=this.m[1]){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new U(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}if(0!=this.m[4]||0!=this.m[5]){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new U(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}return new U(0,0)}invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],n=this.m[9]*this.m[15]-this.m[13]*this.m[11],r=this.m[9]*this.m[14]-this.m[13]*this.m[10],s=this.m[8]*this.m[15]-this.m[12]*this.m[11],o=this.m[8]*this.m[14]-this.m[12]*this.m[10],a=this.m[8]*this.m[13]-this.m[12]*this.m[9],l=this.m[6]*this.m[15]-this.m[14]*this.m[7],h=this.m[5]*this.m[15]-this.m[13]*this.m[7],u=this.m[5]*this.m[14]-this.m[13]*this.m[6],d=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],p=this.m[5]*this.m[15]-this.m[13]*this.m[7],f=this.m[4]*this.m[13]-this.m[12]*this.m[5],m=this.m[6]*this.m[11]-this.m[10]*this.m[7],g=this.m[5]*this.m[11]-this.m[9]*this.m[7],w=this.m[5]*this.m[10]-this.m[9]*this.m[6],A=this.m[4]*this.m[11]-this.m[8]*this.m[7],v=this.m[4]*this.m[10]-this.m[8]*this.m[6],y=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*n+this.m[7]*r,e[4]=-(this.m[4]*t-this.m[6]*s+this.m[7]*o),e[8]=this.m[4]*n-this.m[5]*s+this.m[7]*a,e[12]=-(this.m[4]*r-this.m[5]*o+this.m[6]*a),e[1]=-(this.m[1]*t-this.m[2]*n+this.m[3]*r),e[5]=this.m[0]*t-this.m[2]*s+this.m[3]*o,e[9]=-(this.m[0]*n-this.m[1]*s+this.m[3]*a),e[13]=this.m[0]*r-this.m[1]*o+this.m[2]*a,e[2]=this.m[1]*l-this.m[2]*h+this.m[3]*u,e[6]=-(this.m[0]*l-this.m[2]*d+this.m[3]*c),e[10]=this.m[0]*p-this.m[1]*d+this.m[3]*f,e[14]=-(this.m[0]*u-this.m[1]*c+this.m[2]*f),e[3]=-(this.m[1]*m-this.m[2]*g+this.m[3]*w),e[7]=this.m[0]*m-this.m[2]*A+this.m[3]*v,e[11]=-(this.m[0]*g-this.m[1]*A+this.m[3]*y),e[15]=this.m[0]*w-this.m[1]*v+this.m[2]*y;let V=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let i=0;i<4;i++)for(let t=0;t<4;t++)e[4*i+t]*=1/V;return new i(e)}clone(){return new i([...this.m])}toString(){return this.m.toString()}},"Mat4"),i);function K(e,t,n,i=e=>-Math.cos(e)){return e+(i(n)+1)/2*(t-e)}k(K,"wave");var Y=2147483648,z=(k(r=class{constructor(e){R(this,"seed"),this.seed=e}gen(){return this.seed=(1103515245*this.seed+12345)%Y,this.seed/Y}genNumber(e,t){return e+this.gen()*(t-e)}genVec2(e,t){return new U(this.genNumber(e.x,t.x),this.genNumber(e.y,t.y))}genColor(e,t){return new N(this.genNumber(e.r,t.r),this.genNumber(e.g,t.g),this.genNumber(e.b,t.b))}genAny(...e){if(0===e.length)return this.gen();if(1===e.length){if("number"==typeof e[0])return this.genNumber(0,e[0]);if(e[0]instanceof U)return this.genVec2(L(0,0),e[0]);if(e[0]instanceof N)return this.genColor(G(0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.genNumber(e[0],e[1]);if(e[0]instanceof U&&e[1]instanceof U)return this.genVec2(e[0],e[1]);if(e[0]instanceof N&&e[1]instanceof N)return this.genColor(e[0],e[1])}}},"RNG"),r),Q=new z(Date.now());function W(e){return null!=e&&(Q.seed=e),Q.seed}function J(...e){return Q.genAny(...e)}function X(...e){return Math.floor(J(...e))}function Z(e){return J()<=e}function _(e){return e[X(e.length)]}function $(e,t){return e.pos.x+e.width>t.pos.x&&e.pos.x<t.pos.x+t.width&&e.pos.y+e.height>t.pos.y&&e.pos.y<t.pos.y+t.height}function ee(e,t){if(e.p1.x===e.p2.x&&e.p1.y===e.p2.y||t.p1.x===t.p2.x&&t.p1.y===t.p2.y)return null;let n=(t.p2.y-t.p1.y)*(e.p2.x-e.p1.x)-(t.p2.x-t.p1.x)*(e.p2.y-e.p1.y);if(0===n)return null;let i=((t.p2.x-t.p1.x)*(e.p1.y-t.p1.y)-(t.p2.y-t.p1.y)*(e.p1.x-t.p1.x))/n,r=((e.p2.x-e.p1.x)*(e.p1.y-t.p1.y)-(e.p2.y-e.p1.y)*(e.p1.x-t.p1.x))/n;return i<0||i>1||r<0||r>1?null:i}function te(e,t){let n=ee(e,t);return n?L(e.p1.x+n*(e.p2.x-e.p1.x),e.p1.y+n*(e.p2.y-e.p1.y)):null}function ne(e,t){if(ie(e,t.p1)||ie(e,t.p2))return!0;let n=e.points();return!!(te(t,new he(n[0],n[1]))||te(t,new he(n[1],n[2]))||te(t,new he(n[2],n[3]))||te(t,new he(n[3],n[0])))}function ie(e,t){return t.x>e.pos.x&&t.x<e.pos.x+e.width&&t.y>e.pos.y&&t.y<e.pos.y+e.height}function re(e,t){let n=t.sub(e.p1),i=e.p2.sub(e.p1);if(Math.abs(n.cross(i))>Number.EPSILON)return!1;let r=n.dot(i)/i.dot(i);return r>=0&&r<=1}function se(e,t){let n=e.p2.sub(e.p1),i=n.dot(n),r=e.p1.sub(t.center),s=2*n.dot(r),o=s*s-4*i*(r.dot(r)-t.radius*t.radius);if(i<=Number.EPSILON||o<0)return!1;if(0==o){let e=-s/(2*i);if(e>=0&&e<=1)return!0}else{let e=(-s+Math.sqrt(o))/(2*i),t=(-s-Math.sqrt(o))/(2*i);if(e>=0&&e<=1||t>=0&&t<=1)return!0}return oe(t,e.p1)}function oe(e,t){return e.center.sdist(t)<e.radius*e.radius}function ae(e,t){let n=t.pts[t.pts.length-1];for(let i of t.pts){if(se(new he(n,i),e))return!0;n=i}return!!oe(e,t.pts[0])||le(t,e.center)}function le(e,t){let n=!1,i=e.pts;for(let r=0,s=i.length-1;r<i.length;s=r++)i[r].y>t.y!=i[s].y>t.y&&t.x<(i[s].x-i[r].x)*(t.y-i[r].y)/(i[s].y-i[r].y)+i[r].x&&(n=!n);return n}k(W,"randSeed"),k(J,"rand"),k(X,"randi"),k(Z,"chance"),k(_,"choose"),k($,"testRectRect"),k(ee,"testLineLineT"),k(te,"testLineLine"),k(ne,"testRectLine"),k(ie,"testRectPoint"),k(re,"testLinePoint"),k(se,"testLineCircle"),k(oe,"testCirclePoint"),k(ae,"testCirclePolygon"),k(le,"testPolygonPoint");var he=(k(s=class{constructor(e,t){R(this,"p1"),R(this,"p2"),this.p1=e.clone(),this.p2=t.clone()}transform(e){return new s(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return ue.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new s(this.p1,this.p2)}},"Line"),s),ue=(k(o=class{constructor(e,t,n){R(this,"pos"),R(this,"width"),R(this,"height"),this.pos=e.clone(),this.width=t,this.height=n}static fromPoints(e,t){return new o(e.clone(),t.x-e.x,t.y-e.y)}center(){return new U(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new pe(this.points().map((t=>e.multVec2(t))))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new o(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let t=this.pos,n=this.pos.add(this.width,this.height),i=Math.max(t.x-e.x,0,e.x-n.x),r=Math.max(t.y-e.y,0,e.y-n.y);return i*i+r*r}},"Rect"),o),de=(k(a=class{constructor(e,t){R(this,"center"),R(this,"radius"),this.center=e.clone(),this.radius=t}transform(e){return new ce(this.center,this.radius,this.radius).transform(e)}bbox(){return ue.fromPoints(this.center.sub(L(this.radius)),this.center.add(L(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new a(this.center,this.radius)}},"Circle"),a),ce=(k(l=class{constructor(e,t,n){R(this,"center"),R(this,"radiusX"),R(this,"radiusY"),this.center=e.clone(),this.radiusX=t,this.radiusY=n}transform(e){return new l(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY)}bbox(){return ue.fromPoints(this.center.sub(L(this.radiusX,this.radiusY)),this.center.add(L(this.radiusX,this.radiusY)))}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new l(this.center,this.radiusX,this.radiusY)}},"Ellipse"),l),pe=(k(h=class{constructor(e){if(R(this,"pts"),e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new h(this.pts.map((t=>e.multVec2(t))))}bbox(){let e=L(Number.MAX_VALUE),t=L(-Number.MAX_VALUE);for(let n of this.pts)e.x=Math.min(e.x,n.x),t.x=Math.max(t.x,n.x),e.y=Math.min(e.y,n.y),t.y=Math.max(t.y,n.y);return ue.fromPoints(e,t)}area(){let e=0,t=this.pts.length;for(let n=0;n<t;n++){let i=this.pts[n],r=this.pts[(n+1)%t];e+=i.x*r.y*.5,e-=r.x*i.y*.5}return Math.abs(e)}clone(){return new h(this.pts.map((e=>e.clone())))}},"Polygon"),h);function fe(e,t){let n=Number.MAX_VALUE,i=L(0);for(let r of[e,t])for(let s=0;s<r.pts.length;s++){let o=r.pts[s],a=r.pts[(s+1)%r.pts.length].sub(o).normal().unit(),l=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(let t=0;t<e.pts.length;t++){let n=e.pts[t].dot(a);l=Math.min(l,n),h=Math.max(h,n)}let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let e=0;e<t.pts.length;e++){let n=t.pts[e].dot(a);u=Math.min(u,n),d=Math.max(d,n)}let c=Math.min(h,d)-Math.max(l,u);if(c<0)return null;if(c<Math.abs(n)){let e=d-l,t=u-h;n=Math.abs(e)<Math.abs(t)?e:t,i=a.scale(n)}}return i}k(fe,"sat");var me=(u=class extends Map{constructor(...e){super(...e),R(this,"lastID"),this.lastID=0}push(e){let t=this.lastID;return this.set(t,e),this.lastID++,t}pushd(e){let t=this.push(e);return()=>this.delete(t)}},k(u,"Registry"),u),ge=(k(d=class{constructor(e){R(this,"paused",!1),R(this,"cancel"),this.cancel=e}static join(e){let t=new d((()=>e.forEach((e=>e.cancel()))));return Object.defineProperty(t,"paused",{get:()=>e[0].paused,set:t=>e.forEach((e=>e.paused=t))}),t.paused=!1,t}},"EventController"),d),we=(k(c=class{constructor(){R(this,"handlers",new me)}add(e){let t=this.handlers.pushd(((...t)=>{n.paused||e(...t)})),n=new ge(t);return n}addOnce(e){let t=this.add(((...n)=>{t.cancel(),e(...n)}));return t}next(){return new Promise((e=>this.addOnce(e)))}trigger(...e){this.handlers.forEach((t=>t(...e)))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},"Event"),c),Ae=(k(p=class{constructor(){R(this,"handlers",{})}on(e,t){return this.handlers[e]||(this.handlers[e]=new we),this.handlers[e].add(t)}onOnce(e,t){let n=this.on(e,((...e)=>{n.cancel(),t(...e)}));return n}next(e){return new Promise((t=>{this.onOnce(e,((...e)=>t(e[0])))}))}trigger(e,...t){this.handlers[e]&&this.handlers[e].trigger(...t)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){var t;return(null==(t=this.handlers[e])?void 0:t.numListeners())??0}},"EventHandler"),p);function ve(e,t){if(e===t)return!0;let n=typeof e,i=typeof t;if(n!==i)return!1;if("object"===n&&"object"===i&&null!==e&&null!==t){if(Array.isArray(e)!==Array.isArray(t))return!1;let n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(let r of n){if(!ve(e[r],t[r]))return!1}return!0}return!1}function ye(e){let t=window.atob(e),n=t.length,i=new Uint8Array(n);for(let r=0;r<n;r++)i[r]=t.charCodeAt(r);return i.buffer}function Ve(e){return ye(e.split(",")[1])}function xe(e,t){let n=document.createElement("a");n.href=t,n.download=e,n.click()}function Ee(e,t){xe(e,"data:text/plain;charset=utf-8,"+t)}function be(e,t){Ee(e,JSON.stringify(t))}function Se(e,t){let n=URL.createObjectURL(t);xe(e,n),URL.revokeObjectURL(n)}k(ve,"deepEq"),k(ye,"base64ToArrayBuffer"),k(Ve,"dataURLToArrayBuffer"),k(xe,"download"),k(Ee,"downloadText"),k(be,"downloadJSON"),k(Se,"downloadBlob");var Re=k((e=>e.match(/^data:\w+\/\w+;base64,.+/)),"isDataURL"),Me=k((e=>e.split(".").slice(0,-1).join(".")),"getFileName");function ke(e,t){return(...n)=>{let i=n.length;return i===e.length?e(...n):i===t.length?t(...n):void 0}}k(ke,"overload2");var Te=(()=>{let e=0;return()=>e++})(),Ie=k((e=>e instanceof Error?e.message:String(e)),"getErrorMessage"),Be=(k(f=class{constructor(e=(e,t)=>e<t){R(this,"_items"),R(this,"_compareFn"),this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(0===this._items.length)return null;let e=this._items[0],t=this._items.pop();return 0!==this._items.length&&(this._items[0]=t,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let t=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[t])&&this._items[e]>=this._items[t])break;this.swap(e,t),e=t}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let t=2*e+1;if(t<this._items.length-1&&!this._compareFn(this._items[t],this._items[t+1])&&++t,this._compareFn(this._items[e],this._items[t]))break;this.swap(e,t),e=t}}swap(e,t){[this._items[e],this._items[t]]=[this._items[t],this._items[e]]}get length(){return this._items.length}},"BinaryHeap"),f),Pe=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function Fe(e){if("string"!=typeof e)throw new TypeError("string cannot be undefined or null");let t=[],n=0,i=0;for(;n<e.length;)i+=Ce(n+i,e),He(e[n+i])&&i++,Ge(e[n+i])&&i++,Oe(e[n+i])&&i++,je(e[n+i])?i++:(t.push(e.substring(n,n+i)),n+=i,i=0);return t}function Ce(e,t){let n=t[e];if(!De(n)||e===t.length-1)return 1;let i=n+t[e+1],r=t.substring(e+2,e+5);return Ue(i)&&Ue(r)?4:Le(i)&&qe(r)?t.slice(e).indexOf(String.fromCodePoint(917631))+2:Ne(r)?4:2}function De(e){return e&&Ye(e[0].charCodeAt(0),55296,56319)}function Ue(e){return Ye(Ke(e),127462,127487)}function Le(e){return Ye(Ke(e),127988,127988)}function Ne(e){return Ye(Ke(e),127995,127999)}function Ge(e){return"string"==typeof e&&Ye(e.charCodeAt(0),65024,65039)}function Oe(e){return"string"==typeof e&&Ye(e.charCodeAt(0),8400,8447)}function qe(e){let t=e.codePointAt(0);return"string"==typeof e&&"number"==typeof t&&Ye(t,917504,917631)}function He(e){return"string"==typeof e&&Pe.includes(e.charCodeAt(0))}function je(e){return"string"==typeof e&&8205===e.charCodeAt(0)}function Ke(e){return(e.charCodeAt(0)-55296<<10)+(e.charCodeAt(1)-56320)+65536}function Ye(e,t,n){return e>=t&&e<=n}k(Fe,"runes"),k(Ce,"nextUnits"),k(De,"isFirstOfSurrogatePair"),k(Ue,"isRegionalIndicator"),k(Le,"isSubdivisionFlag"),k(Ne,"isFitzpatrickModifier"),k(Ge,"isVariationSelector"),k(Oe,"isDiacriticalMark"),k(qe,"isSupplementarySpecialpurposePlane"),k(He,"isGrapheme"),k(je,"isZeroWidthJoiner"),k(Ke,"codePointFromSurrogatePair"),k(Ye,"betweenInclusive");var ze={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"select",10:"lstick",16:"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",9:"start",10:"lstick",16:"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home",17:"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{0:"south",1:"east",2:"west",3:"north",4:"lshoulder",5:"rshoulder",6:"ltrigger",7:"rtrigger",8:"select",9:"start",10:"lstick",11:"rstick",12:"dpad-up",13:"dpad-down",14:"dpad-left",15:"dpad-right",16:"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}},Qe=(k(m=class{constructor(){R(this,"pressed",new Set([])),R(this,"pressedRepeat",new Set([])),R(this,"released",new Set([])),R(this,"down",new Set([]))}update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},"ButtonState"),m),We=(k(g=class{constructor(){R(this,"buttonState",new Qe),R(this,"stickState",new Map)}},"GamepadState"),g),Je=(k(w=class{constructor(){R(this,"dts",[]),R(this,"timer",0),R(this,"fps",0)}tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce(((e,t)=>e+t))/this.dts.length)),this.dts=[])}},"FPSCounter"),w),Xe=k((e=>{if(!e.canvas)throw new Error("Please provide a canvas");let t={canvas:e.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new Je,timeScale:1,skipTime:!1,numFrames:0,mousePos:new U(0),mouseDeltaPos:new U(0),keyState:new Qe,mouseState:new Qe,mergedGamepadState:new We,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:e.canvas.offsetWidth,lastHeight:e.canvas.offsetHeight,events:new Ae};function n(){return t.dt*t.timeScale}function i(){return t.time}function r(){return t.fpsCounter.fps}function s(){return t.numFrames}function o(){return t.canvas.toDataURL()}function a(e){t.canvas.style.cursor=e}function l(){return t.canvas.style.cursor}function h(e){if(e)try{let e=t.canvas.requestPointerLock();e.catch&&e.catch((e=>console.error(e)))}catch(n){console.error(n)}else document.exitPointerLock()}function u(){return!!document.pointerLockElement}function d(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}function c(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}function p(){return document.fullscreenElement||document.webkitFullscreenElement}function f(e=!0){e?d(t.canvas):c()}function m(){return!!p()}function g(){t.stopped=!0;for(let e in de)t.canvas.removeEventListener(e,de[e]);for(let e in ce)document.removeEventListener(e,ce[e]);for(let e in pe)window.removeEventListener(e,pe[e]);ve.disconnect()}function w(i){null!==t.loopID&&cancelAnimationFrame(t.loopID);let r=0,s=k((o=>{if(t.stopped)return;if("visible"!==document.visibilityState)return void(t.loopID=requestAnimationFrame(s));let a=o/1e3,l=a-t.realTime,h=e.maxFPS?1/e.maxFPS:0;t.realTime=a,r+=l,r>h&&(t.skipTime||(t.dt=r,t.time+=n(),t.fpsCounter.tick(t.dt)),r=0,t.skipTime=!1,t.numFrames++,oe(),i(),ae()),t.loopID=requestAnimationFrame(s)}),"frame");s(0)}function A(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function v(){return t.mousePos.clone()}function y(){return t.mouseDeltaPos.clone()}function V(e="left"){return t.mouseState.pressed.has(e)}function x(e="left"){return t.mouseState.down.has(e)}function E(e="left"){return t.mouseState.released.has(e)}function b(){return t.isMouseMoved}function S(e){return void 0===e?t.keyState.pressed.size>0:t.keyState.pressed.has(e)}function R(e){return void 0===e?t.keyState.pressedRepeat.size>0:t.keyState.pressedRepeat.has(e)}function M(e){return void 0===e?t.keyState.down.size>0:t.keyState.down.has(e)}function T(e){return void 0===e?t.keyState.released.size>0:t.keyState.released.has(e)}function I(e){return void 0===e?t.mergedGamepadState.buttonState.pressed.size>0:t.mergedGamepadState.buttonState.pressed.has(e)}function B(e){return void 0===e?t.mergedGamepadState.buttonState.down.size>0:t.mergedGamepadState.buttonState.down.has(e)}function P(e){return void 0===e?t.mergedGamepadState.buttonState.released.size>0:t.mergedGamepadState.buttonState.released.has(e)}function F(e){return t.events.on("resize",e)}k(n,"dt"),k(i,"time"),k(r,"fps"),k(s,"numFrames"),k(o,"screenshot"),k(a,"setCursor"),k(l,"getCursor"),k(h,"setCursorLocked"),k(u,"isCursorLocked"),k(d,"enterFullscreen"),k(c,"exitFullscreen"),k(p,"getFullscreenElement"),k(f,"setFullscreen"),k(m,"isFullscreen"),k(g,"quit"),k(w,"run"),k(A,"isTouchscreen"),k(v,"mousePos"),k(y,"mouseDeltaPos"),k(V,"isMousePressed"),k(x,"isMouseDown"),k(E,"isMouseReleased"),k(b,"isMouseMoved"),k(S,"isKeyPressed"),k(R,"isKeyPressedRepeat"),k(M,"isKeyDown"),k(T,"isKeyReleased"),k(I,"isGamepadButtonPressed"),k(B,"isGamepadButtonDown"),k(P,"isGamepadButtonReleased"),k(F,"onResize");let D=ke((e=>t.events.on("keyDown",e)),((e,n)=>t.events.on("keyDown",(t=>t===e&&n(e))))),L=ke((e=>t.events.on("keyPress",e)),((e,n)=>t.events.on("keyPress",(t=>t===e&&n(e))))),N=ke((e=>t.events.on("keyPressRepeat",e)),((e,n)=>t.events.on("keyPressRepeat",(t=>t===e&&n(e))))),G=ke((e=>t.events.on("keyRelease",e)),((e,n)=>t.events.on("keyRelease",(t=>t===e&&n(e))))),O=ke((e=>t.events.on("mouseDown",(t=>e(t)))),((e,n)=>t.events.on("mouseDown",(t=>t===e&&n(t))))),q=ke((e=>t.events.on("mousePress",(t=>e(t)))),((e,n)=>t.events.on("mousePress",(t=>t===e&&n(t))))),H=ke((e=>t.events.on("mouseRelease",(t=>e(t)))),((e,n)=>t.events.on("mouseRelease",(t=>t===e&&n(t)))));function j(e){return t.events.on("mouseMove",(()=>e(v(),y())))}function K(e){return t.events.on("charInput",e)}function Y(e){return t.events.on("touchStart",e)}function z(e){return t.events.on("touchMove",e)}function Q(e){return t.events.on("touchEnd",e)}function W(e){return t.events.on("scroll",e)}function J(e){return t.events.on("hide",e)}function X(e){return t.events.on("show",e)}function Z(e,n){return"function"==typeof e?t.events.on("gamepadButtonDown",e):"string"==typeof e&&"function"==typeof n?t.events.on("gamepadButtonDown",(t=>t===e&&n(e))):void 0}function _(e,n){return"function"==typeof e?t.events.on("gamepadButtonPress",e):"string"==typeof e&&"function"==typeof n?t.events.on("gamepadButtonPress",(t=>t===e&&n(e))):void 0}function $(e,n){return"function"==typeof e?t.events.on("gamepadButtonRelease",e):"string"==typeof e&&"function"==typeof n?t.events.on("gamepadButtonRelease",(t=>t===e&&n(e))):void 0}function ee(e,n){return t.events.on("gamepadStick",((t,i)=>t===e&&n(i)))}function te(e){t.events.on("gamepadConnect",e)}function ne(e){t.events.on("gamepadDisconnect",e)}function ie(e){return t.mergedGamepadState.stickState.get(e)||new U(0)}function re(){return[...t.charInputted]}function se(){return[...t.gamepads]}function oe(){t.events.trigger("input"),t.keyState.down.forEach((e=>t.events.trigger("keyDown",e))),t.mouseState.down.forEach((e=>t.events.trigger("mouseDown",e))),ue()}function ae(){t.keyState.update(),t.mouseState.update(),t.mergedGamepadState.buttonState.update(),t.mergedGamepadState.stickState.forEach(((e,n)=>{t.mergedGamepadState.stickState.set(n,new U(0))})),t.charInputted=[],t.isMouseMoved=!1,t.gamepadStates.forEach((e=>{e.buttonState.update(),e.stickState.forEach(((t,n)=>{e.stickState.set(n,new U(0))}))}))}function le(e){let n={index:e.index,isPressed:n=>t.gamepadStates.get(e.index).buttonState.pressed.has(n),isDown:n=>t.gamepadStates.get(e.index).buttonState.down.has(n),isReleased:n=>t.gamepadStates.get(e.index).buttonState.released.has(n),getStick:n=>t.gamepadStates.get(e.index).stickState.get(n)};return t.gamepads.push(n),t.gamepadStates.set(e.index,{buttonState:new Qe,stickState:new Map([["left",new U(0)],["right",new U(0)]])}),n}function he(e){t.gamepads=t.gamepads.filter((t=>t.index!==e.index)),t.gamepadStates.delete(e.index)}function ue(){for(let e of navigator.getGamepads())e&&!t.gamepadStates.has(e.index)&&le(e);for(let n of t.gamepads){let i=navigator.getGamepads()[n.index],r=(e.gamepads??{})[i.id]??ze[i.id]??ze.default,s=t.gamepadStates.get(n.index);for(let e=0;e<i.buttons.length;e++)i.buttons[e].pressed?(s.buttonState.down.has(r.buttons[e])||(t.mergedGamepadState.buttonState.press(r.buttons[e]),s.buttonState.press(r.buttons[e]),t.events.trigger("gamepadButtonPress",r.buttons[e])),t.events.trigger("gamepadButtonDown",r.buttons[e])):s.buttonState.down.has(r.buttons[e])&&(t.mergedGamepadState.buttonState.release(r.buttons[e]),s.buttonState.release(r.buttons[e]),t.events.trigger("gamepadButtonRelease",r.buttons[e]));for(let e in r.sticks){let n=r.sticks[e],o=new U(i.axes[n.x],i.axes[n.y]);s.stickState.set(e,o),t.mergedGamepadState.stickState.set(e,o),t.events.trigger("gamepadStick",e,o)}}}k(j,"onMouseMove"),k(K,"onCharInput"),k(Y,"onTouchStart"),k(z,"onTouchMove"),k(Q,"onTouchEnd"),k(W,"onScroll"),k(J,"onHide"),k(X,"onShow"),k(Z,"onGamepadButtonDown"),k(_,"onGamepadButtonPress"),k($,"onGamepadButtonRelease"),k(ee,"onGamepadStick"),k(te,"onGamepadConnect"),k(ne,"onGamepadDisconnect"),k(ie,"getGamepadStick"),k(re,"charInputted"),k(se,"getGamepads"),k(oe,"processInput"),k(ae,"resetInput"),k(le,"registerGamepad"),k(he,"removeGamepad"),k(ue,"processGamepad");let de={},ce={},pe={},fe=e.pixelDensity||window.devicePixelRatio||1;de.mousemove=e=>{let n=new U(e.offsetX,e.offsetY),i=new U(e.movementX,e.movementY);if(m()){let i=t.canvas.width/fe,r=t.canvas.height/fe,s=window.innerWidth,o=window.innerHeight;if(s/o>i/r){let t=o/r,a=(s-i*t)/2;n.x=C(e.offsetX-a,0,i*t,0,i),n.y=C(e.offsetY,0,r*t,0,r)}else{let t=s/i,a=(o-r*t)/2;n.x=C(e.offsetX,0,i*t,0,i),n.y=C(e.offsetY-a,0,r*t,0,r)}}t.events.onOnce("input",(()=>{t.isMouseMoved=!0,t.mousePos=n,t.mouseDeltaPos=i,t.events.trigger("mouseMove")}))};let me=["left","middle","right","back","forward"];de.mousedown=e=>{t.events.onOnce("input",(()=>{let n=me[e.button];n&&(t.mouseState.press(n),t.events.trigger("mousePress",n))}))},de.mouseup=e=>{t.events.onOnce("input",(()=>{let n=me[e.button];n&&(t.mouseState.release(n),t.events.trigger("mouseRelease",n))}))};let ge=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),we={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};de.keydown=e=>{ge.has(e.key)&&e.preventDefault(),t.events.onOnce("input",(()=>{let n=we[e.key]||e.key.toLowerCase();1===n.length?(t.events.trigger("charInput",n),t.charInputted.push(n)):"space"===n&&(t.events.trigger("charInput"," "),t.charInputted.push(" ")),e.repeat?(t.keyState.pressRepeat(n),t.events.trigger("keyPressRepeat",n)):(t.keyState.press(n),t.events.trigger("keyPressRepeat",n),t.events.trigger("keyPress",n))}))},de.keyup=e=>{t.events.onOnce("input",(()=>{let n=we[e.key]||e.key.toLowerCase();t.keyState.release(n),t.events.trigger("keyRelease",n)}))},de.touchstart=n=>{n.preventDefault(),t.events.onOnce("input",(()=>{let i=[...n.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new U(i[0].clientX-r.x,i[0].clientY-r.y),t.mouseState.press("left"),t.events.trigger("mousePress","left")),i.forEach((e=>{t.events.trigger("touchStart",new U(e.clientX-r.x,e.clientY-r.y),e)}))}))},de.touchmove=n=>{n.preventDefault(),t.events.onOnce("input",(()=>{let i=[...n.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new U(i[0].clientX-r.x,i[0].clientY-r.y),t.events.trigger("mouseMove")),i.forEach((e=>{t.events.trigger("touchMove",new U(e.clientX-r.x,e.clientY-r.y),e)}))}))},de.touchend=n=>{t.events.onOnce("input",(()=>{let i=[...n.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new U(i[0].clientX-r.x,i[0].clientY-r.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),i.forEach((e=>{t.events.trigger("touchEnd",new U(e.clientX-r.x,e.clientY-r.y),e)}))}))},de.touchcancel=n=>{t.events.onOnce("input",(()=>{let i=[...n.changedTouches],r=t.canvas.getBoundingClientRect();!1!==e.touchToMouse&&(t.mousePos=new U(i[0].clientX-r.x,i[0].clientY-r.y),t.mouseState.release("left"),t.events.trigger("mouseRelease","left")),i.forEach((e=>{t.events.trigger("touchEnd",new U(e.clientX-r.x,e.clientY-r.y),e)}))}))},de.wheel=e=>{e.preventDefault(),t.events.onOnce("input",(()=>{t.events.trigger("scroll",new U(e.deltaX,e.deltaY))}))},de.contextmenu=e=>e.preventDefault(),ce.visibilitychange=()=>{"visible"===document.visibilityState?(t.skipTime=!0,t.events.trigger("show")):t.events.trigger("hide")},pe.gamepadconnected=e=>{let n=le(e.gamepad);t.events.onOnce("input",(()=>{t.events.trigger("gamepadConnect",n)}))},pe.gamepaddisconnected=e=>{let n=se().filter((t=>t.index===e.gamepad.index))[0];he(e.gamepad),t.events.onOnce("input",(()=>{t.events.trigger("gamepadDisconnect",n)}))};for(let k in de)t.canvas.addEventListener(k,de[k]);for(let k in ce)document.addEventListener(k,ce[k]);for(let k in pe)window.addEventListener(k,pe[k]);let ve=new ResizeObserver((e=>{for(let n of e)if(n.target===t.canvas){if(t.lastWidth===t.canvas.offsetWidth&&t.lastHeight===t.canvas.offsetHeight)return;t.lastWidth=t.canvas.offsetWidth,t.lastHeight=t.canvas.offsetHeight,t.events.onOnce("input",(()=>{t.events.trigger("resize")}))}}));return ve.observe(t.canvas),{dt:n,time:i,run:w,canvas:t.canvas,fps:r,numFrames:s,quit:g,setFullscreen:f,isFullscreen:m,setCursor:a,screenshot:o,getGamepads:se,getCursor:l,setCursorLocked:h,isCursorLocked:u,isTouchscreen:A,mousePos:v,mouseDeltaPos:y,isKeyDown:M,isKeyPressed:S,isKeyPressedRepeat:R,isKeyReleased:T,isMouseDown:x,isMousePressed:V,isMouseReleased:E,isMouseMoved:b,isGamepadButtonPressed:I,isGamepadButtonDown:B,isGamepadButtonReleased:P,getGamepadStick:ie,charInputted:re,onResize:F,onKeyDown:D,onKeyPress:L,onKeyPressRepeat:N,onKeyRelease:G,onMouseDown:O,onMousePress:q,onMouseRelease:H,onMouseMove:j,onCharInput:K,onTouchStart:Y,onTouchMove:z,onTouchEnd:Q,onScroll:W,onHide:J,onShow:X,onGamepadButtonDown:Z,onGamepadButtonPress:_,onGamepadButtonRelease:$,onGamepadStick:ee,onGamepadConnect:te,onGamepadDisconnect:ne,events:t.events}}),"default"),Ze=(k(A=class{constructor(e,t,n,i={}){R(this,"ctx"),R(this,"src",null),R(this,"glTex"),R(this,"width"),R(this,"height"),this.ctx=e;let r=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy((()=>this.free())),this.width=t,this.height=n;let s={linear:r.LINEAR,nearest:r.NEAREST}[i.filter??e.opts.texFilter]??r.NEAREST,o={repeat:r.REPEAT,clampToEadge:r.CLAMP_TO_EDGE}[i.wrap]??r.CLAMP_TO_EDGE;this.bind(),t&&n&&r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,n,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,o),this.unbind()}static fromImage(e,t,n={}){let i=new A(e,t.width,t.height,n);return i.update(t),i.src=t,i}update(e,t=0,n=0){let i=this.ctx.gl;this.bind(),i.texSubImage2D(i.TEXTURE_2D,0,t,n,i.RGBA,i.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},"Texture"),A),_e=(k(v=class{constructor(e,t,n,i={}){R(this,"ctx"),R(this,"tex"),R(this,"glFramebuffer"),R(this,"glRenderbuffer"),this.ctx=e;let r=e.gl;e.onDestroy((()=>this.free())),this.tex=new Ze(e,t,n,i),this.glFramebuffer=r.createFramebuffer(),this.glRenderbuffer=r.createRenderbuffer(),this.bind(),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.tex.glTex,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,t=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,t),this.unbind();let n=4*this.width,i=new Uint8Array(n);for(let r=0;r<(this.height/2|0);r++){let e=r*n,s=(this.height-r-1)*n;i.set(t.subarray(e,e+n)),t.copyWithin(e,s,s+n),t.set(i,s)}return new ImageData(t,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.width,e.height=this.height,t.putImageData(this.toImageData(),0,0),e.toDataURL()}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},"FrameBuffer"),v),$e=(k(y=class{constructor(e,t,n,i){R(this,"ctx"),R(this,"glProgram"),this.ctx=e,e.onDestroy((()=>this.free()));let r=e.gl,s=r.createShader(r.VERTEX_SHADER),o=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(s,t),r.shaderSource(o,n),r.compileShader(s),r.compileShader(o);let a=r.createProgram();if(this.glProgram=a,r.attachShader(a,s),r.attachShader(a,o),i.forEach(((e,t)=>r.bindAttribLocation(a,t,e))),r.linkProgram(a),!r.getProgramParameter(a,r.LINK_STATUS)){let e=r.getShaderInfoLog(s);if(e)throw new Error("VERTEX SHADER "+e);let t=r.getShaderInfoLog(o);if(t)throw new Error("FRAGMENT SHADER "+t)}r.deleteShader(s),r.deleteShader(o)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let t=this.ctx.gl;for(let n in e){let i=e[n],r=t.getUniformLocation(this.glProgram,n);"number"==typeof i?t.uniform1f(r,i):i instanceof j?t.uniformMatrix4fv(r,!1,new Float32Array(i.m)):i instanceof N?t.uniform3f(r,i.r,i.g,i.b):i instanceof U&&t.uniform2f(r,i.x,i.y)}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},"Shader"),y),et=(k(V=class{constructor(e,t,n,i){R(this,"ctx"),R(this,"glVBuf"),R(this,"glIBuf"),R(this,"vqueue",[]),R(this,"iqueue",[]),R(this,"stride"),R(this,"maxVertices"),R(this,"maxIndices"),R(this,"vertexFormat"),R(this,"numDraws",0),R(this,"curPrimitive",null),R(this,"curTex",null),R(this,"curShader",null),R(this,"curUniform",{});let r=e.gl;this.vertexFormat=t,this.ctx=e,this.stride=t.reduce(((e,t)=>e+t.size),0),this.maxVertices=n,this.maxIndices=i,this.glVBuf=r.createBuffer(),e.pushArrayBuffer(this.glVBuf),r.bufferData(r.ARRAY_BUFFER,4*n,r.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=r.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),r.bufferData(r.ELEMENT_ARRAY_BUFFER,4*i,r.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,t,n,i,r=null,s={}){(e!==this.curPrimitive||r!==this.curTex||i!==this.curShader||!ve(this.curUniform,s)||this.vqueue.length+t.length*this.stride>this.maxVertices||this.iqueue.length+n.length>this.maxIndices)&&this.flush();let o=this.vqueue.length/this.stride;for(let a of t)this.vqueue.push(a);for(let a of n)this.iqueue.push(a+o);this.curPrimitive=e,this.curShader=i,this.curTex=r,this.curUniform=s}flush(){var e,t;if(!this.curPrimitive||!this.curShader||0===this.vqueue.length||0===this.iqueue.length)return;let n=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),n.bufferSubData(n.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),null==(e=this.curTex)||e.bind(),n.drawElements(this.curPrimitive,this.iqueue.length,n.UNSIGNED_SHORT,0),null==(t=this.curTex)||t.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}},"BatchRenderer"),V);function tt(e){let t=[],n=k((n=>{t.push(n),e(n)}),"push"),i=k((()=>{t.pop(),e(r()??null)}),"pop"),r=k((()=>t[t.length-1]),"cur");return[n,i,r]}function nt(e,t={}){let n=[];function i(e){n.push(e)}function r(){n.forEach((e=>e())),e.getExtension("WEBGL_lose_context").loseContext()}k(i,"onDestroy"),k(r,"destroy");let s=null;function o(t){if(ve(t,s))return;s=t;let n=t.reduce(((e,t)=>e+t.size),0);t.reduce(((t,i,r)=>(e.vertexAttribPointer(r,i.size,e.FLOAT,!1,4*n,t),e.enableVertexAttribArray(r),t+4*i.size)),0)}k(o,"setVertexFormat");let[a,l]=tt((t=>e.bindTexture(e.TEXTURE_2D,t))),[h,u]=tt((t=>e.bindBuffer(e.ARRAY_BUFFER,t))),[d,c]=tt((t=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t))),[p,f]=tt((t=>e.bindFramebuffer(e.FRAMEBUFFER,t))),[m,g]=tt((t=>e.bindRenderbuffer(e.RENDERBUFFER,t))),[w,A]=tt((({x:t,y:n,w:i,h:r})=>{e.viewport(t,n,i,r)})),[v,y]=tt((t=>e.useProgram(t)));return w({x:0,y:0,w:e.drawingBufferWidth,h:e.drawingBufferHeight}),{gl:e,opts:t,onDestroy:i,destroy:r,pushTexture2D:a,popTexture2D:l,pushArrayBuffer:h,popArrayBuffer:u,pushElementArrayBuffer:d,popElementArrayBuffer:c,pushFramebuffer:p,popFramebuffer:f,pushRenderbuffer:m,popRenderbuffer:g,pushViewport:w,popViewport:A,pushProgram:v,popProgram:y,setVertexFormat:o}}k(tt,"genStack"),k(nt,"initGfx");var it=(k(x=class{constructor(e){R(this,"loaded",!1),R(this,"data",null),R(this,"error",null),R(this,"onLoadEvents",new we),R(this,"onErrorEvents",new we),R(this,"onFinishEvents",new we),e.then((e=>{this.data=e,this.onLoadEvents.trigger(e)})).catch((e=>{if(this.error=e,!(this.onErrorEvents.numListeners()>0))throw e;this.onErrorEvents.trigger(e)})).finally((()=>{this.onFinishEvents.trigger(),this.loaded=!0}))}static loaded(e){let t=new x(Promise.resolve(e));return t.data=e,t.loaded=!0,t}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},"Asset"),x),rt=(k(E=class{constructor(){R(this,"assets",new Map),R(this,"lastUID",0)}add(e,t){let n=e??this.lastUID+++"",i=new it(t);return this.assets.set(n,i),i}addLoaded(e,t){let n=e??this.lastUID+++"",i=it.loaded(t);return this.assets.set(n,i),i}get(e){return this.assets.get(e)}progress(){if(0===this.assets.size)return 1;let e=0;return this.assets.forEach((t=>{t.loaded&&e++})),e/this.assets.size}},"AssetBucket"),E);function st(e){return fetch(e).then((t=>{if(!t.ok)throw new Error(`Failed to fetch "${e}"`);return t}))}function ot(e){return st(e).then((e=>e.json()))}function at(e){return st(e).then((e=>e.text()))}function lt(e){return st(e).then((e=>e.arrayBuffer()))}function ht(e){let t=new Image;return t.crossOrigin="anonymous",t.src=e,new Promise(((n,i)=>{t.onload=()=>n(t),t.onerror=()=>i(new Error(`Failed to load image from "${e}"`))}))}k(st,"fetchURL"),k(ot,"fetchJSON"),k(at,"fetchText"),k(lt,"fetchArrayBuffer"),k(ht,"loadImg");var ut=2.5949095,dt=2.70158,ct=2*Math.PI/3,pt=2*Math.PI/4.5,ft={linear:e=>e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>dt*e*e*e-1.70158*e*e,easeOutBack:e=>1+dt*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-ut)/2:(Math.pow(2*e-2,2)*((ut+1)*(2*e-2)+ut)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*ct),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*ct)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*pt)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*pt)/2+1,easeInBounce:e=>1-ft.easeOutBounce(1-e),easeOutBounce:e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,easeInOutBounce:e=>e<.5?(1-ft.easeOutBounce(1-2*e))/2:(1+ft.easeOutBounce(2*e-1))/2},mt=ft,gt=(k(b=class{constructor(e,t,n){R(this,"textures",[]),R(this,"canvas"),R(this,"c2d"),R(this,"x",0),R(this,"y",0),R(this,"curHeight",0),R(this,"gfx"),this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=n,this.textures=[Ze.fromImage(e,this.canvas)],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height)throw new Error(`Texture size (${e.width} x ${e.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`);this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(Ze.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let t=this.textures[this.textures.length-1],n=new U(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,n.x,n.y):this.c2d.drawImage(e,n.x,n.y),t.update(this.canvas),[t,new q(n.x/this.canvas.width,n.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free()}},"TexPacker"),b),wt=T("SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAASAAAeMwAUFBQUFCIiIiIiIjAwMDAwPj4+Pj4+TExMTExZWVlZWVlnZ2dnZ3V1dXV1dYODg4ODkZGRkZGRn5+fn5+frKysrKy6urq6urrIyMjIyNbW1tbW1uTk5OTk8vLy8vLy//////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAQKAAAAAAAAHjOZTf9/AAAAAAAAAAAAAAAAAAAAAP/7kGQAAANUMEoFPeACNQV40KEYABEY41g5vAAA9RjpZxRwAImU+W8eshaFpAQgALAAYALATx/nYDYCMJ0HITQYYA7AH4c7MoGsnCMU5pnW+OQnBcDrQ9Xx7w37/D+PimYavV8elKUpT5fqx5VjV6vZ38eJR48eRKa9KUp7v396UgPHkQwMAAAAAA//8MAOp39CECAAhlIEEIIECBAgTT1oj///tEQYT0wgEIYxgDC09aIiE7u7u7uIiIz+LtoIQGE/+XAGYLjpTAIOGYYy0ZACgDgSNFxC7YYiINocwERjAEDhIy0mRoGwAE7lOTBsGhj1qrXNCU9GrgwSPr80jj0dIpT9DRUNHKJbRxiWSiifVHuD2b0EbjLkOUzSXztP3uE1JpHzV6NPq+f3P5T0/f/lNH7lWTavQ5Xz1yLVe653///qf93B7f/vMdaKJAAJAMAIwIMAHMpzDkoYwD8CR717zVb8/p54P3MikXGCEWhQOEAOAdP6v8b8oNL/EzdnROC8Zo+z+71O8VVAGIKFEglKbidkoLam0mAFiwo0ZoVExf/7kmQLgAQyZFxvPWAENcVKXeK0ABAk2WFMaSNIzBMptBYfArbkZgpWjEQpcmjxQoG2qREWQcvpzuuIm29THt3ElhDNlrXV///XTGbm7Kbx0ymcRX///x7GVvquf5vk/dPs0Wi5Td1vggDxqbNII4bAPTU3Ix5h9FJTe7zv1LHG/uPsPrvth0ejchVzVT3giirs6sQAACgQAAIAdaXbRAYra/2t0//3HwqLKIlBOJhOg4BzAOkt+MOL6H8nlNvKyi3rOnqP//zf6AATwBAKIcHKixxwjl1TjDVIrvTqdmKQOFQBUBDwZ1EhHlDEGEVyGQWBAHrcJgRSXYbkvHK/8/6rbYjs4Qj0C8mRy2hwRv/82opGT55fROgRoBTjanaiQiMRHUu1/P3V9yGFffaVv78U1/6l/kpo0cz73vuSv/9GeaqDVRA5bWdHRKQKIEAAAAoIktKeEmdQFKN5sguv/ZSC0oxCAR7CzcJgEsd8cA0M/x0tzv15E7//5L5KCqoIAAmBFIKM1UxYtMMFjLKESTE8lhaelUyCBYeA2IN4rK1iDt//+5JkEgAkZzlVq29D8DJDWo0YLLARwPFZrL0PyLsUazTAlpI+hKSx01VSOfbjXg0iW9/jVPDleLJ15QQA4Okdc5ByMDFIeuCCE5CvevwBGH8YibiX9FtaIIgUikF42wrZw6ZJ6WlHrA+Ki5++NNMeYH1lEkwwJAIJB4ugVFguXFc20Vd/FLlvq1GSiSwAFABABABA47k6BFeNvxEQZO9v3L1IE4iEVElfrXmEmlyWIyGslFA55gH/sW7////o9AAFIBIIAAIUMzYTTNkgsAmYObfwQyzplrOmYvq0BKCKNN+nUTbvD7cJzvHxrEWG5QqvP8U1vFx6CwE8NoRc2ADBeEb/HoXh60N7ST8nw9QiiGoYvf/r6GtC9+vLwXHjaSkIp3iupC5+Nii81Zhu85pNYbFvrf+UFThDOYYY26off+W6b//73GTiN9xDfl0AAwBAiMBO8qsDBPOZtuT/dTbjVVbY/KSGH6ppHwKv/6X+s8gUCN/lODzv////GQAGAMQAADlXAUCBJiY0wFQZusYQOaQzaTwDBTcx0IvVp8m7uxKp//uSZBMCBHRI1eNPLHAyxNqWGeoYUIEnWYyxD8DUFSn0l6iojcd+oEOkzV6uWqyHNzjqmv+7V5xGUfY9yEmbziTzjRscm9OqFQp1PKFrqu3PX/7YuGtDU6bt0OUTpv38rdc+37dVDQLKUchaJ853E9edNDGqWwsYz1VoiSStEJtZvw6+sNqFWqaIXJjQCGAAGWAYVwmag/x3BRJw1wYF7IzVqDcNzn85d//FzK7IgwbQwccLoB4AsF8Nj/1ESRUAAVJwAFh0YOFEhmSJEHKQRDyhszgLUpHIgFrb5cySFg5jv10ImlYuvaaGBItfXqnNPmic+XNkmb5fW49vdhq97nQMQyGIlM2v8oQSrxKSxE4F1WqrduqvuJCRof1R7Gsre9KszUVF1/t3PzH2tnp+iSUG3rDwGNcDzxCGA8atuQF0paZAAkAhAQAEAC240yJV+nJgUrqq8axAYtVpYjZyFGb13/17jwiClQDaCdytZpyHHf1R/EG/+lUAgAAAChhmJvioVGGBCFgqdpsGAkUUrbTstwTCJgLQpFIsELW7t/68Iv/7kmQUgAQ9NFO9aeAAPAU6RKwUABClY2e5hoARGpDvPydCAsY8WO10fSvUOnfT98+n/l/6/+hxslhQ1DEOaevNKGocvIYba8WJpaP/15pX0NQ1DUNn/////k6lPp/N61rBi8RJFfERV3IgrqDsJA64sjCoKxDDQ9xEcWDpMBDwVFDIAEIAAzryxsjGi4q/oWpixKjhklAF4pUrDPjFhFVupDFZ/t/t0YPAygUBhADPR/KLCKJ8h2Oxhpxz/zNRAAFl0MAZLAYEAiVbEiz36LSgZ5QoQVat69KNy8FyM5Z80ACHAzgnISEkxUSJIDyBSwi5KF4mjBl4xJdbrG9ComLrL8YATiodhQKCkj6ROdyg1y5XmZlvMVmpJzYppJDwLi/Lp9vT3TfmimOGpuezi2U/9FNav0zX9Oja2r//8+hvuihuQAAMAVmqFgAgCcuboAEAAAUcqy8ca0BHBmwbFkED0CNA1YYDPkhcQrRJxcY3BzfxxltAz9vX62Xl3plAzWmRO+FkZyH///1qAAEjQBAACUpgU5o2AIBmFBGMamrGg0b/+5JkC4ADxyLWb2ngAEEkGofsoACP7U1JLaxTkOqFaKhspGgnW3SGC56ZgUJGCRnLOmIJAkuNBgvwU4Ocf8CJK9UsafH9/Frj///365XSoME+DZMw5UNjrMbVoeIj9EL91IuQ5KHyl5V2LCpdIdESgafOHxVGkAlkHuakmix/gN8+BP/sKguLAAoAtUjtvaoeEADwr3OK11E4KBlojgeQNQBJ4MvCAd/4t/xMMzeLhQGQ1//6tQu5BaBOGCT6U4aafvXZ//4iAPAAAAbLkgIlQmMSLA2H1CVNAlWwyVvKIQIxOSK1NWxs4MBUATlKrAkIMPAjCAdS6MVFzuURWa/+/qQWEGsA6EEpiBEJb9Q21lAHoBoD0B6aAPhyt+bG3muoXIN3RLadXxUfr/ohjGFF/p97eqNI5noKAqYLNPpUTDSI9/TmA6B+YAAADgA0Y4lxTW1SQfOQuDDDI0KTTuIrF5qoJrUFhUFAsg+AT2hbkaRZYGIjBKVDIa5VgNN/9P/rCDsBJbYJRKpCA1ArAkigIeYY61AjE+jubyiZFZ3+L789//uSZBCABHVj2entNmw1JXokLycYEFTFVa0wz4DYjKs08J2Q+r4n3lgbWaaMwMLEjFW88F39brqPF83cv1mCSJeY3Q2uiQxhBJxCBeR1D2LQRsYQcZUTzdNll8+OwZBsIwSgl45ymaHX603Mz7JmZuvt71GDTN66zev/+cLn/b5imV8pAHkg61FIJchBSG+zycgAZgADD6F1iQQRXRWmWS6bDIIgyBCZEcdl/KgXGmVKFv/vl8ry/5bLypf//U5jhYDhL9X/pAA0AKBIAAKgGtGXGGWJgEoF2JNsHlKfSKLRhGBAgIuWZKIJCFpF1VBhkB+EfzEyMUJdWuMrEZoPZ5BfF3/Nu62riIdjoO4AAKD2sTrDmpZZaYysf/810TitAVvn9xtFucieiaEy54YqiIO6RqkGAm5wVO0bFB0sDTdNxYGekKktR4KAAfAwUIgI8Ci6aXgtwbhPWAC+CKExAFydNtYGXNZoQjUsXv/9vKjgmdwieb+h7kHvPoc//0FaCACAATKFC4Y9ammklidbaiJNPBhGWTNhFSgdtalK12lpl//7kmQRAFN2NFI7TBvwNKNaTRsFGBWdfV2tPNcYvBHpgPKJsc8IUcTCxY3HSvUVNTWe/Z3YWlrJ0yrNRUiT19aprA7E+mPP+ZmC3/CsheOJXhc/9VJb3UZnphUBcqZUZQth1i3XqtPYu2Sy1s8DV9ZYACAAASAAHgFkQcOqgB5utFHFh3kSi4USs0yk4iOClREmjvdG+upaiLcRA6/9QGbOfxF/8sEAQAVG0G07YFMihKR4EXJCkRdX9isueLqUMRAQdhDZmv3KeR0nPqRVrZmSIXDt+BBSR7qqbKQcB98W9qiMb55preHIStxFWPE4lAyI+BKz2iSxonpvMR5DgKxTH6vGGXAbYCaAnJUW4W07EesQqbfqdbo4qNnPxSpn1H8eahszc/y9//dn1V7D/OYpn1szQKAPXTMlO/rO//u7JriJXbld7aP33v6RXYg/COIDzTWkTspg6Ay1YaDSwKxrP/LfIikHjmO871POf/kEAseAgoPEi9/0ZziNwfxVKy9qAEGEEAAq1EcOamDEGHAA0iao8k31rz2MiLNEik6VQ37/+5JkEAgEYU5WU0M3MDjDe0o9IjiOzSVM7aCzEM2GqXD8pFB0zxMcHCQNHtZD+R+pMWZxOJ/otEZTvVN/MeU12xTVcL+f2YaiNJTVoPd6SvzEnKel5GXOzEaazgdChnP2jOAwpfyRpVlQwoJBwpN1L1DL////6TVWcoepf7CVWrpEWiym5lR5U0BSMlxQC4qByOyQIAEuJfIriWixDqRgMfVZWuvRowjR9BzP5lZlT/+YG50CsSBG////////liXDQVMxEaBkbzKAAACnDIAstY7iK7gGSF7SIDexaTtPOHABk9YcmJEACmo50pgWal22etroBpYoVqtU6OPqvlf0c4QCAfLk9P/FJs4KCQMf6ECZyA6BwqqyJ0rMYj56k1/UlTIx1V3Rt5NF71D4qlptDC8VMgQVHFDlQnDFi06qQgKQAAIK4TxxJGFGYJuZNGXRdpq7IW/DYpPIQRFJLAc+qn1E0XYdOkQVJT+z8Lvff//8vbKAWTIBBUUdM6cOhlDry7x4dAkJXIBhbO3HSMMMGBQ9K9/JNfu09PjTO64wYEcR//uSZBeABP5g11NPRVwzQ4r8PMJVj7j9UU2wUwDPjeq0Z5w675D9+uDdL2QsuIry2lZtwn/pJYyRRjANEOQxNWw8mU7Tq+vueV7JrX/Pg7VIkEuZT5dwd85MVoq5lpStNICkBAcFR88//58KO8Zjt2PIGxWl1cVfXeNGH18SReNT//hYliWtQuNluxyxONbm4U+lpkAgpyE7yAIYUjIaqHmARJ0GQTtmH60xdwFp/u253XBCxD0f/lBcguCALn//Y5nqEv//1h4BAAwgAA5gcHmpIplgeW9fAOM6RFZUywrsGAiRmKkanQnCFBjYoPDS7bjwtPTkVI8D/P8VVLcTUz65n7PW2s3tNYHgEul4tBaIz0A9RgJAyAMI4/i0fpQKjhX9S+qIa0vmc4CZit/0/3UTDGeKNpkk0nu2rUE2ag8WErhE/kgAiQCJKQEYBA5Wn6CxHoIUh6dQ46nLIuwFk4S/LaDQxXu7Yf/pf//lwJB0S/Ff/4C///EiBEiAAAIAMnpngiIABAdMpKigkXaUwhLEGvpiofmXW57h2XAZO3CMRv/7kmQUAEOHQlHraRTQMkQp6GWFZBTVU1lNPTPYyIyocYeUoNgLBWAs1jPkTv/tXBaeZ/tbD/nAGP8/xT0SNEi5zof0KIVEzVe9r5lZOol7kyaXMYS4J/ZS3djp//UaeVyR0mUMlTgfz8XqMzIEgAQQ6UNQ1DSE0/C16OvyaocF4ijAGFci0FSYqCUSaWs6t9F6/699DKvMgMoK1//kSbvxtyBN27I7mdXgNMAW75sRU1UwUHYG5axI2tFIFpkgx7nnK+1JmRKjqeAd5Ph0QAL4QAnirmiPlg0yBDlrb/d3ngtA65rb999+8vdDCfnJuJAYIl285zklpVbrKpk1PEzrOY9NZUgyz6OiOsKt5qG/g2ibxSZ+/eTI/NB8n4ev//n2nIw85GAdwuJL7kYnnAbpcf1RBKH6b2U4RWP8dmWH5snsAFYwADBgAopKdzFJq4Jlmotloh/m4QpTSvJRE3nYZHephoqBhVf+P7vQ9BPlwZCP+3//+hdy5uUwS3LDEgQx4cdIgvDEBR1YqymCsSbKzRy2aQmSv+AAcAgAkvzPfuX/+5JkFQAj6VFX00Zr5DllOhhgpn4MmSs+zSRRiO8U5tWklYgSLKfs+Xheb/+6WaAQCKTztNeJ382MUltZNnjSJoFrCqB6C4mFcwJpJD4Oc8dLDXMTh9k1/rmTopfzqv9AvHWfOuZJlEvHSVMjyjpkVucKSzxJVQBgAAIo8DGqRdYCXPckFYg+dH9A/qUyljrtpxH9RJX/Z3Vv6uFkPg4M2jf3CL09QrwOrMt69n//8UFEAAMHWdhg1CcjyVBwiArOYlDL5NPY6x8ZLFBCGi6SVTKX5nqdSEFjebnv2zHdt0dj6xvORsSFzwqRNTJSZIrrlpXcURNL9WW7krBgr5jPMaGcvJ5v0N1s19CV7+7fvQfjySX2QECWUgKgeJCIif4WRBZ/6archpDkzE7oWctK3zEHP9Smeai8oeHkM6AK7pGjtOgeFv40ugqNd+Iv///uAZAMgAAAUeSWhLPpdwk3iXpBw43hOVIp1gliUOSaeZcZeZhLAH9TtD56wUpBduzLF5v5qViTH6o+I0+8Z1asaLgKVAohlpB72DgAQBQxEd3g//uSZCiAA6k0UdMPQfA+xcnBYON8E3WDVU0w1ZjPDSmo8IniHAFDNnkXF3B94gicH5d8MFw+IHZwufxOf/8gsHw+XrD4Jn8T4RAyQiABNBQg/3giEWuZ42mVFB3kkXNjhqBg1CghEUbN3/7/KBhyqNueef/MIDBClP3YRnKLiIlEFzf//0g+4zKpRIKTpqQgUtnHGFw6RSLN421iGcYapqFxny/capK9r9v+2BSy/RU1yZxa2eGaWK07ijfcxeiO3iuHJvjbXzts+Ny+XyFnsne1h0qG4mAaN6xRGaLVxKPlrri0Bg9oXGyxcw8JRBPkUzC8v451vVd9liSX85JMrmkVNwxOCwUg298////7ks//L409/hwMRIozKiIckXtjzDaAMTBcAACAwLGargPSEgEJZN/EFjfF/VKgaMYKMbwtf/T0UCGGfjfOAZ2frCigYdwh/+sGlQBxhCAAAUHkDPqOdmmUdAVYl3IhrEfR8qZFjLYEPOyzVGvm6lNUJCk2PNazwFxaijk+ZEaiTehoJGuDh6zN/EVP8BCLD/88BoY7Xv/7kmQlgBNmMtNTL0FwOGZJ/WHiKAyhJU+soE3A3JnmAa2oaCIru/+RrEHMTphxQ0X/LzoVy4gKhYl6ZUlklW7CLRVoYmgABwCRMAAMA/poCiEEYLsBVodWcVZ18+CcAfH165U4Xgh7/X1/BAQF6GN/BwQ/+D9S9P6wII//CoANYFYCBAKlGQDKhVjjylKARw2mPAtp8JjcQHggQswVsOEKsF6AIBWvmpIFdSZvRVv/LHWEy0+txMxu+VK9gEqG5pWf6GNGU4UBVkfd+bsj/6lZE0fkOpAqAOvyUO9oo+IiEtcLKOGzhhSGa4MYINHWoQsFr8zzmow0tRILkqz5/+vFxl/oZX/+qGW//xiLjR3xcGn//0QLkTQJh1UA8MAQAEXC/YxODKTDUEhrASs1512GRp+dRFFdTWIRaOXrve1eNjTNpreqQYrC9NBlQc1f8YO2po8bnH6qffuRvU7taiNF3baokE0YpmjRCHRclWBb9NCHKHpERwHRG3pqgXklq4sBpLjGvmekg8Y7SjM1FZopIM8IhB6dtMr8aKsdovh4FW//+5JkQ4CjTDdSU0gtIDiE+YBrKgwNbSVJTCBPwN8N5ZW8NKDnhRB8AXCm//KAsBUCwKU//oJQnET+UP3/zpYRocAAABJkVzzIuoLGEaDoxfsNva12EUdxhJMGFQioSg8GxKsLm8kWEmExJuNidarkk+OTXc0i2OZEq2v+tZr/MDZRS0I7LfRpHdlsiF6m/mEjk+XlK10UqtKYUwNgMx24hUtCJLfpM3ExUeKDYjClgZAzAjQ0qlNQBTsGpk9zSRkCiKkRGp572VXsPYChGvxhAuYkDYZK//jSRgto2mTf6+PJqgAAgIAAAACYZE6aZOHhYkYlcbpeYQq1RgLO4U8TIlL1sGw+iKZi5Kzc/bKT0yXrIUMES89RCWy8oWlxqIQlKANLFpT/KjUrK+UCYbZqGnjVj29aO5dzofWAskRX5eJWPi4kf/aRVjy3Wlyg2AnMYIDSTLwZUTASIzflPWUwwlUnIFMnGiyABeaXJcN91PmQJCLzmvUJkFOHCrX/+6O///IHnT4tT9YYBoNMQ09GfKIErwdwChNz1Qy5+5S/wWeY//uSZF+C03UyT2tMO0A3RRkhY20KzQjDMszhA8DjlGOBp5y4ZCS3ica52GIGiryv7FAaSDVZSXKFTiir+GvGiuK4rjgwPVTddso+W/42a4ueJJHDYtfj6YoKknnjzRgKA0fBIRZOSsprJqnoNN73ps/Z9DVgbKNbMGmRzrYBMAZCPUANkAZQ0syAC2ubK1NF90+WoesBpnhY8qwVDkNb/5Uof6//418TgElCSgAIgyAAQBHEmiaQFPIRmfAMELffpo0IflyEuAAQnSnKvwTlVlnIgOAAGS3P3IydjXPSh/CaVRqpSNCjQqDvPM+fLcuN+WgqNix6CoHomUWTT86JjziRSZ3yjnq+dIldKPU11KUuf6wAASMAAJxE+MlyktgE9UGSxjEx6RR0v1s9bWZ+EJSrGtjqUIhklG3J8eLRn/2U/nv7f///+7/6gBQgEAMUijVMwweWWMyYM/PLXuc7DptIQmBARMRCxXjEIcTNDQgSSeHpUNXO7dRSOllJPvnY7yzaO1hmUjsKvHe99fOxrabMX7mGTi5tsNkZVZLndzxse//7kmR7ABM2O0pbKTvQN4NI+WGFPA2ZESs1pYAAvA0jVrJwAHfbr/c6//vW790dzX36QNBRlDv/6QQAU3V64yUgBEAYc/lI8e5bm+Z9+j+4aaj4tFrb//iker/4a12b/V//q//9v+7vAEAAAAMqZTGd5gL4f54o6ZebKNrR/zWVYUEVYVVv8BuAV2OUT+DUQgkJ8J1Ey4ZbFCiAwgwzMSdHV4jQR+OoPWEASaPkyYq+PsQFFJCsEEJtOiUjI/+GRhtC2DnizTMXATJig9Ey/kAJMrkHGYJ8gpLjmJOYoskpav+ShRJInyGGZVJMihDi6pIxRZJJel/8iZPkYiREnyKE0akTL5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),At=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",vt="topleft",yt="monospace",Vt=256,xt="linear",Et=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],bt=8192*Et.reduce(((e,t)=>e+t.size),0),St="\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",Rt="\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",Mt="\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",kt="\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",Tt=new Set(["id","require"]),It=new Set(["add","update","draw","destroy","inspect","drawInspect"]);function Bt(e){switch(e){case"topleft":return new U(-1,-1);case"top":return new U(0,-1);case"topright":return new U(1,-1);case"left":return new U(-1,0);case"center":return new U(0,0);case"right":return new U(1,0);case"botleft":return new U(-1,1);case"bot":return new U(0,1);case"botright":return new U(1,1);default:return e}}function Pt(e){switch(e){case"left":default:return 0;case"center":return.5;case"right":return 1}}function Ft(e){return e.createBuffer(1,1,44100)}k(Bt,"anchorPt"),k(Pt,"alignPt"),k(Ft,"createEmptyAudioBuffer");const Ct=k(((e={})=>{let t=e.root??document.body;t===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let n=e.canvas??(()=>{let e=document.createElement("canvas");return t.appendChild(e),e})(),i=e.scale??1,r=e.width&&e.height&&!e.stretch&&!e.letterbox;r?(n.width=e.width*i,n.height=e.height*i):(n.width=n.parentElement.offsetWidth,n.height=n.parentElement.offsetHeight);let s=["outline: none","cursor: default"];if(r){let e=n.width,t=n.height;s.push(`width: ${e}px`),s.push(`height: ${t}px`)}else s.push("width: 100%"),s.push("height: 100%");e.crisp&&(s.push("image-rendering: pixelated"),s.push("image-rendering: crisp-edges")),n.style.cssText=s.join(";");let o=e.pixelDensity||window.devicePixelRatio;n.width*=o,n.height*=o,n.tabIndex=0;let a=document.createElement("canvas");a.width=Vt,a.height=Vt;let l=a.getContext("2d",{willReadFrequently:!0}),h=Xe({canvas:n,touchToMouse:e.touchToMouse,gamepads:e.gamepads,pixelDensity:e.pixelDensity,maxFPS:e.maxFPS}),u=[],d=h.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),c=nt(d,{texFilter:e.texFilter}),p=(()=>{let t=ut(Mt,kt),n=Ze.fromImage(c,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),r=e.width&&e.height?new _e(c,e.width*o*i,e.height*o*i):new _e(c,d.drawingBufferWidth,d.drawingBufferHeight),s=null,a=1;e.background&&(s=G(e.background),a=Array.isArray(e.background)?e.background[3]:1,d.clearColor(s.r/255,s.g/255,s.b/255,a??1)),d.enable(d.BLEND),d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);let l=new et(c,Et,bt,12288),h=Ze.fromImage(c,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:t,defTex:n,frameBuffer:r,postShader:null,postShaderUniform:null,renderer:l,transform:new j,transformStack:[],bgTex:h,bgColor:s,bgAlpha:a,width:e.width??d.drawingBufferWidth/o/i,height:e.height??d.drawingBufferHeight/o/i,viewport:{x:0,y:0,width:d.drawingBufferWidth,height:d.drawingBufferHeight},fixed:!1}})();const f=class e{constructor(e,t,n={},i=null){R(this,"tex"),R(this,"frames",[new q(0,0,1,1)]),R(this,"anims",{}),R(this,"slice9",null),this.tex=e,t&&(this.frames=t),this.anims=n,this.slice9=i}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(t,n={}){return"string"==typeof t?e.fromURL(t,n):Promise.resolve(e.fromImage(t,n))}static fromImage(t,n={}){let[i,r]=v.packer.add(t),s=n.frames?n.frames.map((e=>new q(r.x+e.x*r.w,r.y+e.y*r.h,e.w*r.w,e.h*r.h))):ee(n.sliceX||1,n.sliceY||1,r.x,r.y,r.w,r.h);return new e(i,s,n.anims,n.slice9)}static fromURL(t,n={}){return ht(t).then((t=>e.fromImage(t,n)))}};k(f,"SpriteData");let m=f;const g=class e{constructor(e){R(this,"buf"),this.buf=e}static fromArrayBuffer(t){return new Promise(((e,n)=>A.ctx.decodeAudioData(t,e,n))).then((t=>new e(t)))}static fromURL(t){return Re(t)?e.fromArrayBuffer(Ve(t)):lt(t).then((t=>e.fromArrayBuffer(t)))}};k(g,"SoundData");let w=g,A=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain();t.connect(e.destination);let n=new w(Ft(e));return e.decodeAudioData(wt.buffer.slice(0)).then((e=>{n.buf=e})).catch((e=>{console.error("Failed to load burp: ",e)})),{ctx:e,masterNode:t,burpSnd:n}})(),v={urlPrefix:"",sprites:new rt,fonts:new rt,bitmapFonts:new rt,sounds:new rt,shaders:new rt,custom:new rt,packer:new gt(c,2048,2048),loaded:!1};function y(e){return"string"!=typeof e||Re(e)?e:v.urlPrefix+e}k(y,"fixURL");let V={events:new Ae,objEvents:new Ae,root:kn([]),gravity:0,scenes:{},logs:[],cam:{pos:null,scale:new U(1),angle:0,shake:0,transform:new j}};function x(e){return v.custom.add(null,e)}function E(){let e=[v.sprites,v.sounds,v.shaders,v.fonts,v.bitmapFonts,v.custom];return e.reduce(((e,t)=>e+t.progress()),0)/e.length}function b(e){return void 0!==e&&(v.urlPrefix=e),v.urlPrefix}function S(e,t){return v.custom.add(e,ot(t))}V.root.use(pi()),k(x,"load"),k(E,"loadProgress"),k(b,"loadRoot"),k(S,"loadJSON");const M=class{constructor(e,t={}){if(R(this,"fontface"),R(this,"filter",xt),R(this,"outline",null),R(this,"size",64),this.fontface=e,this.filter=t.filter??xt,this.size=t.size??64,this.size>Vt)throw new Error("Max font size: 256");t.outline&&(this.outline={width:1,color:G(0,0,0)},"number"==typeof t.outline?this.outline.width=t.outline:"object"==typeof t.outline&&(t.outline.width&&(this.outline.width=t.outline.width),t.outline.color&&(this.outline.color=t.outline.color)))}};k(M,"FontData");let T=M;function Y(e,t,n={}){let i=new FontFace(e,"string"==typeof t?`url(${t})`:t);return document.fonts.add(i),v.fonts.add(e,i.load().catch((e=>{throw new Error(`Failed to load font from "${t}": ${e}`)})).then((e=>new T(e,n))))}function Q(e,t,n,i,r={}){return v.bitmapFonts.add(e,ht(t).then((e=>dt(Ze.fromImage(c,e,r),n,i,r.chars??At))))}function ee(e=1,t=1,n=0,i=0,r=1,s=1){let o=[],a=r/e,l=s/t;for(let h=0;h<t;h++)for(let t=0;t<e;t++)o.push(new q(n+t*a,i+h*l,a,l));return o}function oe(e,t){return e=y(e),x("string"==typeof t?new Promise(((n,i)=>{ot(t).then((t=>{oe(e,t).then(n).catch(i)}))})):m.from(e).then((e=>{let n={};for(let i in t){let r=t[i],s=e.frames[0],o=2048*s.w,a=2048*s.h,l=r.frames?r.frames.map((e=>new q(s.x+(r.x+e.x)/o*s.w,s.y+(r.y+e.y)/a*s.h,e.w/o*s.w,e.h/a*s.h))):ee(r.sliceX||1,r.sliceY||1,s.x+r.x/o*s.w,s.y+r.y/a*s.h,r.width/o*s.w,r.height/a*s.h),h=new m(e.tex,l,r.anims);v.sprites.addLoaded(i,h),n[i]=h}return n})))}function ce(e,t={}){let n=document.createElement("canvas"),i=e[0].width,r=e[0].height;n.width=i*e.length,n.height=r;let s=n.getContext("2d");e.forEach(((e,t)=>{e instanceof ImageData?s.putImageData(e,t*i,0):s.drawImage(e,t*i,0)}));let o=s.getImageData(0,0,e.length*i,r);return m.fromImage(o,{...t,sliceX:e.length,sliceY:1})}function ve(e,t,n={sliceX:1,sliceY:1,anims:{}}){return t=y(t),Array.isArray(t)?t.some((e=>"string"==typeof e))?v.sprites.add(e,Promise.all(t.map((e=>"string"==typeof e?ht(e):Promise.resolve(e)))).then((e=>ce(e,n)))):v.sprites.addLoaded(e,ce(t,n)):"string"==typeof t?v.sprites.add(e,m.from(t,n)):v.sprites.addLoaded(e,m.fromImage(t,n))}function ye(e,t){return t=y(t),v.sprites.add(e,new Promise((async e=>{let n="string"==typeof t?await ot(t):t,i=await Promise.all(n.frames.map(ht)),r=document.createElement("canvas");r.width=n.width,r.height=n.height*n.frames.length;let s=r.getContext("2d");i.forEach(((e,t)=>{s.drawImage(e,0,t*n.height)})),e(await ve(null,r,{sliceY:n.frames.length,anims:n.anims}))})))}function Pe(e,t,n){t=y(t),n=y(n),"string"==typeof t&&!n&&(n=Me(t)+".json");let i="string"==typeof n?ot(n):Promise.resolve(n);return v.sprites.add(e,i.then((e=>{let n=e.meta.size,i=e.frames.map((e=>new q(e.frame.x/n.w,e.frame.y/n.h,e.frame.w/n.w,e.frame.h/n.h))),r={};for(let t of e.meta.frameTags)t.from===t.to?r[t.name]=t.from:r[t.name]={from:t.from,to:t.to,speed:10,loop:!0,pingpong:"pingpong"===t.direction};return m.from(t,{frames:i,anims:r})})))}function Ce(e,t,n){return v.shaders.addLoaded(e,ut(t,n))}function De(e,t,n){t=y(t),n=y(n);let i=k((e=>e?at(e):Promise.resolve(null)),"resolveUrl"),r=Promise.all([i(t),i(n)]).then((([e,t])=>ut(e,t)));return v.shaders.add(e,r)}function Ue(e,t){return t=y(t),v.sounds.add(e,"string"==typeof t?w.fromURL(t):w.fromArrayBuffer(t))}function Le(e="bean"){return ve(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==")}function Ne(e){return v.sprites.get(e)}function Ge(e){return v.sounds.get(e)}function Oe(e){return v.fonts.get(e)}function qe(e){return v.bitmapFonts.get(e)}function He(e){return v.shaders.get(e)}function je(e){return v.custom.get(e)}function Ke(e){if("string"==typeof e){let t=Ne(e);if(t)return t;if(E()<1)return null;throw new Error(`Sprite not found: ${e}`)}if(e instanceof m)return it.loaded(e);if(e instanceof it)return e;throw new Error(`Invalid sprite: ${e}`)}function Ye(e){if("string"==typeof e){let t=Ge(e);if(t)return t;if(E()<1)return null;throw new Error(`Sound not found: ${e}`)}if(e instanceof w)return it.loaded(e);if(e instanceof it)return e;throw new Error(`Invalid sound: ${e}`)}function ze(e){if(!e)return p.defShader;if("string"==typeof e){let t=He(e);if(t)return t.data??t;if(E()<1)return null;throw new Error(`Shader not found: ${e}`)}return e instanceof it&&e.data?e.data:e}function Qe(t){if(!t)return Qe(e.font??"monospace");if("string"==typeof t){let e=qe(t),n=Oe(t);if(e)return e.data??e;if(n)return n.data??n;if(document.fonts.check(`64px ${t}`))return t;if(E()<1)return null;throw new Error(`Font not found: ${t}`)}return t instanceof it&&t.data?t.data:t}function We(e){return void 0!==e&&(A.masterNode.gain.value=e),A.masterNode.gain.value}function Je(e,t={}){let n=A.ctx,i=t.paused??!1,r=n.createBufferSource(),s=new we,o=n.createGain(),a=t.seek??0,l=0,h=0,u=!1;r.loop=!!t.loop,r.detune.value=t.detune??0,r.playbackRate.value=t.speed??1,r.connect(o),r.onended=()=>{var e;p()>=(null==(e=r.buffer)?void 0:e.duration)&&s.trigger()},o.connect(A.masterNode),o.gain.value=t.volume??1;let d=k((e=>{r.buffer=e.buf,i||(l=n.currentTime,r.start(0,a),u=!0)}),"start"),c=Ye(e);c instanceof it&&c.onLoad(d);let p=k((()=>{if(!r.buffer)return 0;let e=i?h-l:n.currentTime-l,t=r.buffer.duration;return r.loop?e%t:Math.min(e,t)}),"getTime"),f=k((e=>{let t=n.createBufferSource();return t.buffer=e.buffer,t.loop=e.loop,t.playbackRate.value=e.playbackRate.value,t.detune.value=e.detune.value,t.onended=e.onended,t.connect(o),t}),"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(e){if(i!==e)if(i=e,e)u&&(r.stop(),u=!1),h=n.currentTime;else{r=f(r);let e=h-l;r.start(0,e),u=!0,l=n.currentTime-e,h=0}},get paused(){return i},play(e=0){this.seek(e),this.paused=!1},seek(e){var t;(null==(t=r.buffer)?void 0:t.duration)&&(e>r.buffer.duration||(i?(r=f(r),l=h-e):(r.stop(),r=f(r),l=n.currentTime-e,r.start(0,e),u=!0,h=0)))},set speed(e){r.playbackRate.value=e},get speed(){return r.playbackRate.value},set detune(e){r.detune.value=e},get detune(){return r.detune.value},set volume(e){o.gain.value=Math.max(e,0)},get volume(){return o.gain.value},set loop(e){r.loop=e},get loop(){return r.loop},duration(){var e;return(null==(e=r.buffer)?void 0:e.duration)??0},time(){return p()%this.duration()},onEnd:e=>s.add(e),then(e){return this.onEnd(e)}}}function tt(e){return Je(A.burpSnd,e)}function st(e,t){return new _e(c,e,t)}function ut(e=Mt,t=kt){let n=St.replace("{{user}}",e??Mt),i=Rt.replace("{{user}}",t??kt);try{return new $e(c,n,i,Et.map((e=>e.name)))}catch(r){let e=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,t=Ie(r).match(e),n=Number(t.groups.line)-14,i=t.groups.msg.trim(),s=t.groups.type.toLowerCase();throw new Error(`${s} shader line ${n}: ${i}`)}}function dt(e,t,n,i){let r=e.width/t,s={},o=i.split("").entries();for(let[a,l]of o)s[l]=new q(a%r*t,Math.floor(a/r)*n,t,n);return{tex:e,map:s,size:n}}function ct(e,t,n,i=p.defTex,r=p.defShader,s={}){let o=ze(r);if(!o||o instanceof it)return;let a=p.fixed||n?p.transform:V.cam.transform.mult(p.transform),l=[];for(let h of e){let e=Ut(a.multVec2(h.pos));l.push(e.x,e.y,h.uv.x,h.uv.y,h.color.r/255,h.color.g/255,h.color.b/255,h.opacity)}p.renderer.push(d.TRIANGLES,l,t,o,i,s)}function pt(){p.renderer.flush()}function ft(){d.clear(d.COLOR_BUFFER_BIT),p.frameBuffer.bind(),d.clear(d.COLOR_BUFFER_BIT),p.bgColor||sn((()=>{jt({width:pn(),height:fn(),quad:new q(0,0,pn()/64,fn()/64),tex:p.bgTex,fixed:!0})})),p.renderer.numDraws=0,p.fixed=!1,p.transformStack.length=0,p.transform=new j}function Ct(e,t){p.postShader=e,p.postShaderUniform=t??null}function Dt(){pt(),p.lastDrawCalls=p.renderer.numDraws,p.frameBuffer.unbind(),d.viewport(0,0,d.drawingBufferWidth,d.drawingBufferHeight);let e=p.width,t=p.height;p.width=d.drawingBufferWidth/o,p.height=d.drawingBufferHeight/o,Kt({flipY:!0,tex:p.frameBuffer.tex,pos:new U(p.viewport.x,p.viewport.y),width:p.viewport.width,height:p.viewport.height,shader:p.postShader,uniform:"function"==typeof p.postShaderUniform?p.postShaderUniform():p.postShaderUniform,fixed:!0}),pt(),p.width=e,p.height=t}function Ut(e){return new U(e.x/pn()*2-1,-e.y/fn()*2+1)}function Lt(e){p.transform=e.clone()}function Nt(...e){if(void 0===e[0])return;let t=L(...e);0===t.x&&0===t.y||p.transform.translate(t)}function Gt(...e){if(void 0===e[0])return;let t=L(...e);1===t.x&&1===t.y||p.transform.scale(t)}function Ot(e){e&&p.transform.rotate(e)}function qt(){p.transformStack.push(p.transform.clone())}function Ht(){p.transformStack.length>0&&(p.transform=p.transformStack.pop())}function jt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawUVQuad() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,i=Bt(e.anchor||vt).scale(new U(t,n).scale(-.5)),r=e.quad||new q(0,0,1,1),s=e.color||G(255,255,255),o=e.opacity??1,a=e.tex?.1/e.tex.width:0,l=e.tex?.1/e.tex.height:0,h=r.x+a,u=r.y+l,d=r.w-2*a,c=r.h-2*l;qt(),Nt(e.pos),Ot(e.angle),Gt(e.scale),Nt(i),ct([{pos:new U(-t/2,n/2),uv:new U(e.flipX?h+d:h,e.flipY?u:u+c),color:s,opacity:o},{pos:new U(-t/2,-n/2),uv:new U(e.flipX?h+d:h,e.flipY?u+c:u),color:s,opacity:o},{pos:new U(t/2,-n/2),uv:new U(e.flipX?h:h+d,e.flipY?u+c:u),color:s,opacity:o},{pos:new U(t/2,n/2),uv:new U(e.flipX?h:h+d,e.flipY?u:u+c),color:s,opacity:o}],[0,1,3,1,2,3],e.fixed,e.tex,e.shader,e.uniform),Ht()}function Kt(e){if(!e.tex)throw new Error('drawTexture() requires property "tex".');let t=e.quad??new q(0,0,1,1),n=e.tex.width*t.w,i=e.tex.height*t.h,r=new U(1);if(e.tiled){let s=Math.ceil((e.width||n)/n),o=Math.ceil((e.height||i)/i),a=Bt(e.anchor||vt).add(new U(1,1)).scale(.5).scale(s*n,o*i);for(let l=0;l<s;l++)for(let s=0;s<o;s++)jt(Object.assign({},e,{pos:(e.pos||new U(0)).add(new U(n*l,i*s)).sub(a),scale:r.scale(e.scale||new U(1)),tex:e.tex,quad:t,width:n,height:i,anchor:"topleft"}))}else e.width&&e.height?(r.x=e.width/n,r.y=e.height/i):e.width?(r.x=e.width/n,r.y=r.x):e.height&&(r.y=e.height/i,r.x=r.y),jt(Object.assign({},e,{scale:r.scale(e.scale||new U(1)),tex:e.tex,quad:t,width:n,height:i}))}function Yt(e){if(!e.sprite)throw new Error('drawSprite() requires property "sprite"');let t=Ke(e.sprite);if(!t||!t.data)return;let n=t.data.frames[e.frame??0];if(!n)throw new Error(`Frame not found: ${e.frame??0}`);Kt(Object.assign({},e,{tex:t.data.tex,quad:n.scale(e.quad??new q(0,0,1,1))}))}function zt(e,t,n,i,r,s=1){i=I(i%360),(r=I(r%360))<=i&&(r+=2*Math.PI);let o=[],a=(r-i)/Math.ceil((r-i)/I(8)*s);for(let l=i;l<r;l+=a)o.push(e.add(t*Math.cos(l),n*Math.sin(l)));return o.push(e.add(t*Math.cos(r),n*Math.sin(r))),o}function Qt(e){if(void 0===e.width||void 0===e.height)throw new Error('drawRect() requires property "width" and "height".');if(e.width<=0||e.height<=0)return;let t=e.width,n=e.height,i=Bt(e.anchor||vt).add(1,1).scale(new U(t,n).scale(-.5)),r=[new U(0,0),new U(t,0),new U(t,n),new U(0,n)];if(e.radius){let i=Math.min(Math.min(t,n)/2,e.radius);r=[new U(i,0),new U(t-i,0),...zt(new U(t-i,i),i,i,270,360),new U(t,i),new U(t,n-i),...zt(new U(t-i,n-i),i,i,0,90),new U(t-i,n),new U(i,n),...zt(new U(i,n-i),i,i,90,180),new U(0,n-i),new U(0,i),...zt(new U(i,i),i,i,180,270)]}$t(Object.assign({},e,{offset:i,pts:r,...e.gradient?{colors:e.horizontal?[e.gradient[0],e.gradient[1],e.gradient[1],e.gradient[0]]:[e.gradient[0],e.gradient[0],e.gradient[1],e.gradient[1]]}:{}}))}function Wt(e){let{p1:t,p2:n}=e;if(!t||!n)throw new Error('drawLine() requires properties "p1" and "p2".');let i=e.width||1,r=n.sub(t).unit().normal().scale(.5*i);ct([t.sub(r),t.add(r),n.add(r),n.sub(r)].map((t=>({pos:new U(t.x,t.y),uv:new U(0),color:e.color??N.WHITE,opacity:e.opacity??1}))),[0,1,3,1,2,3],e.fixed,p.defTex,e.shader,e.uniform)}function Jt(e){let t=e.pts;if(!t)throw new Error('drawLines() requires property "pts".');if(!(t.length<2))if(e.radius&&t.length>=3){let n=t[0].sdist(t[1]);for(let e=1;e<t.length-1;e++)n=Math.min(t[e].sdist(t[e+1]),n);Math.min(e.radius,Math.sqrt(n)/2),Wt(Object.assign({},e,{p1:t[0],p2:t[1]}));for(let i=1;i<t.length-2;i++){let n=t[i],r=t[i+1];Wt(Object.assign({},e,{p1:n,p2:r}))}Wt(Object.assign({},e,{p1:t[t.length-2],p2:t[t.length-1]}))}else for(let n=0;n<t.length-1;n++)Wt(Object.assign({},e,{p1:t[n],p2:t[n+1]})),"none"!==e.join&&Zt(Object.assign({},e,{pos:t[n],radius:e.width/2}))}function Xt(e){if(!e.p1||!e.p2||!e.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return $t(Object.assign({},e,{pts:[e.p1,e.p2,e.p3]}))}function Zt(e){if("number"!=typeof e.radius)throw new Error('drawCircle() requires property "radius".');0!==e.radius&&_t(Object.assign({},e,{radiusX:e.radius,radiusY:e.radius,angle:0}))}function _t(e){if(void 0===e.radiusX||void 0===e.radiusY)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(0===e.radiusX||0===e.radiusY)return;let t=e.start??0,n=e.end??360,i=Bt(e.anchor??"center").scale(new U(-e.radiusX,-e.radiusY)),r=zt(i,e.radiusX,e.radiusY,t,n,e.resolution);r.unshift(i);let s=Object.assign({},e,{pts:r,radius:0,...e.gradient?{colors:[e.gradient[0],...Array(r.length-1).fill(e.gradient[1])]}:{}});if(n-t>=360&&e.outline)return!1!==e.fill&&$t(Object.assign(s,{outline:null})),void $t(Object.assign(s,{pts:r.slice(1),fill:!1}));$t(s)}function $t(e){if(!e.pts)throw new Error('drawPolygon() requires property "pts".');let t=e.pts.length;if(!(t<3)){if(qt(),Nt(e.pos),Gt(e.scale),Ot(e.angle),Nt(e.offset),!1!==e.fill){let n=e.color??N.WHITE,i=e.pts.map(((t,i)=>({pos:new U(t.x,t.y),uv:new U(0,0),color:e.colors&&e.colors[i]?e.colors[i].mult(n):n,opacity:e.opacity??1}))),r=[...Array(t-2).keys()].map((e=>[0,e+1,e+2])).flat();ct(i,e.indices??r,e.fixed,p.defTex,e.shader,e.uniform)}e.outline&&Jt({pts:[...e.pts,e.pts[0]],radius:e.radius,width:e.outline.width,color:e.outline.color,join:e.outline.join,uniform:e.uniform,fixed:e.fixed,opacity:e.opacity}),Ht()}}function en(e,t,n){pt(),d.clear(d.STENCIL_BUFFER_BIT),d.enable(d.STENCIL_TEST),d.stencilFunc(d.NEVER,1,255),d.stencilOp(d.REPLACE,d.REPLACE,d.REPLACE),t(),pt(),d.stencilFunc(n,1,255),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),e(),pt(),d.disable(d.STENCIL_TEST)}function tn(e,t){en(e,t,d.EQUAL)}function nn(e,t){en(e,t,d.NOTEQUAL)}function rn(){return(p.viewport.width+p.viewport.height)/(p.width+p.height)}function sn(e){pt();let t=p.width,n=p.height;p.width=p.viewport.width,p.height=p.viewport.height,e(),pt(),p.width=t,p.height=n}function on(e,t){t.pos&&(e.pos=e.pos.add(t.pos)),t.scale&&(e.scale=e.scale.scale(L(t.scale))),t.angle&&(e.angle+=t.angle),t.color&&1===e.ch.length&&(e.color=e.color.mult(t.color)),t.opacity&&(e.opacity*=t.opacity)}k(Y,"loadFont"),k(Q,"loadBitmapFont"),k(ee,"slice"),k(oe,"loadSpriteAtlas"),k(ce,"createSpriteSheet"),k(ve,"loadSprite"),k(ye,"loadPedit"),k(Pe,"loadAseprite"),k(Ce,"loadShader"),k(De,"loadShaderURL"),k(Ue,"loadSound"),k(Le,"loadBean"),k(Ne,"getSprite"),k(Ge,"getSound"),k(Oe,"getFont"),k(qe,"getBitmapFont"),k(He,"getShader"),k(je,"getAsset"),k(Ke,"resolveSprite"),k(Ye,"resolveSound"),k(ze,"resolveShader"),k(Qe,"resolveFont"),k(We,"volume"),k(Je,"play"),k(tt,"burp"),k(st,"makeCanvas"),k(ut,"makeShader"),k(dt,"makeFont"),k(ct,"drawRaw"),k(pt,"flush"),k(ft,"frameStart"),k(Ct,"usePostEffect"),k(Dt,"frameEnd"),k(Ut,"screen2ndc"),k(Lt,"pushMatrix"),k(Nt,"pushTranslate"),k(Gt,"pushScale"),k(Ot,"pushRotate"),k(qt,"pushTransform"),k(Ht,"popTransform"),k(jt,"drawUVQuad"),k(Kt,"drawTexture"),k(Yt,"drawSprite"),k(zt,"getArcPts"),k(Qt,"drawRect"),k(Wt,"drawLine"),k(Jt,"drawLines"),k(Xt,"drawTriangle"),k(Zt,"drawCircle"),k(_t,"drawEllipse"),k($t,"drawPolygon"),k(en,"drawStenciled"),k(tn,"drawMasked"),k(nn,"drawSubtracted"),k(rn,"getViewportScale"),k(sn,"drawUnscaled"),k(on,"applyCharTransform");let an=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g;function ln(e){let t={},n=e.replace(an,"$2"),i=0;for(let r of e.matchAll(an)){let e=r.index-i;for(let n=0;n<r.groups.text.length;n++)t[n+e]=[r.groups.style];i+=r[0].length-r.groups.text.length}return{charStyleMap:t,text:n}}k(ln,"compileStyledText");let hn={};function un(e){var t,n;if(void 0===e.text)throw new Error('formatText() requires property "text".');let i=Qe(e.font);if(""===e.text||i instanceof it||!i)return{width:0,height:0,chars:[],opt:e};let{charStyleMap:r,text:s}=ln(e.text+""),o=Fe(s);if(i instanceof T||"string"==typeof i){let e=i instanceof T?i.fontface.family:i,r=i instanceof T?{outline:i.outline,filter:i.filter}:{outline:null,filter:xt},s=hn[e]??{font:{tex:new Ze(c,2048,2048,{filter:r.filter}),map:{},size:64},cursor:new U(0),outline:r.outline};hn[e]||(hn[e]=s),i=s.font;for(let h of o)if(!s.font.map[h]){let r=l;r.clearRect(0,0,a.width,a.height),r.font=`${i.size}px ${e}`,r.textBaseline="top",r.textAlign="left",r.fillStyle="#ffffff";let o=r.measureText(h),u=Math.ceil(o.width),d=i.size;s.outline&&(r.lineJoin="round",r.lineWidth=2*s.outline.width,r.strokeStyle=s.outline.color.toHex(),r.strokeText(h,s.outline.width,s.outline.width),u+=2*s.outline.width,d+=3*s.outline.width),r.fillText(h,(null==(t=s.outline)?void 0:t.width)??0,(null==(n=s.outline)?void 0:n.width)??0);let c=r.getImageData(0,0,u,d);if(s.cursor.x+u>2048&&(s.cursor.x=0,s.cursor.y+=d,s.cursor.y>2048))throw new Error("Font atlas exceeds character limit");i.tex.update(c,s.cursor.x,s.cursor.y),i.map[h]=new q(s.cursor.x,s.cursor.y,u,d),s.cursor.x+=u}}let h=e.size||i.size,u=L(e.scale??1).scale(h/i.size),d=e.lineSpacing??0,p=e.letterSpacing??0,f=0,m=0,g=0,w=[],A=[],v=0,y=null,V=null;for(;v<o.length;){let t=o[v];if("\n"===t)g+=h+d,w.push({width:f-p,chars:A}),y=null,V=null,f=0,A=[];else{let n=i.map[t];if(n){let r=n.w*u.x;e.width&&f+r>e.width&&(g+=h+d,null!=y&&(v-=A.length-y,t=o[v],n=i.map[t],r=n.w*u.x,A=A.slice(0,y-1),f=V),y=null,V=null,w.push({width:f-p,chars:A}),f=0,A=[]),A.push({tex:i.tex,width:n.w,height:n.h,quad:new q(n.x/i.tex.width,n.y/i.tex.height,n.w/i.tex.width,n.h/i.tex.height),ch:t,pos:new U(f,g),opacity:e.opacity??1,color:e.color??N.WHITE,scale:L(u),angle:0})," "===t&&(y=A.length,V=f),f+=r,m=Math.max(m,f),f+=p}}v++}w.push({width:f-p,chars:A}),g+=h,e.width&&(m=e.width);let x=[];for(let a of w){let t=(m-a.width)*Pt(e.align??"left");for(let n of a.chars){let s=i.map[n.ch],o=x.length;if(n.pos=n.pos.add(t,0).add(s.w*u.x*.5,s.h*u.y*.5),e.transform){let t="function"==typeof e.transform?e.transform(o,n.ch):e.transform;t&&on(n,t)}if(r[o]){let t=r[o];for(let i of t){let t=e.styles[i],r="function"==typeof t?t(o,n.ch):t;r&&on(n,r)}}x.push(n)}}return{width:m,height:g,chars:x,opt:e}}function dn(e){cn(un(e))}function cn(e){qt(),Nt(e.opt.pos),Ot(e.opt.angle),Nt(Bt(e.opt.anchor??"topleft").add(1,1).scale(e.width,e.height).scale(-.5)),e.chars.forEach((t=>{jt({tex:t.tex,width:t.width,height:t.height,pos:t.pos,scale:t.scale,angle:t.angle,color:t.color,opacity:t.opacity,quad:t.quad,anchor:"center",uniform:e.opt.uniform,shader:e.opt.shader,fixed:e.opt.fixed})})),Ht()}function pn(){return p.width}function fn(){return p.height}function mn(e){return new U((e.x-p.viewport.x)*pn()/p.viewport.width,(e.y-p.viewport.y)*fn()/p.viewport.height)}function gn(e){return new U(e.x*p.viewport.width/p.width,e.y*p.viewport.height/p.height)}function wn(){return mn(h.mousePos())}k(un,"formatText"),k(dn,"drawText"),k(cn,"drawFormattedText"),k(pn,"width"),k(fn,"height"),k(mn,"windowToContent"),k(gn,"contentToView"),k(wn,"mousePos");let An=!1,vn={inspect:!1,timeScale:1,showLog:!0,fps:()=>h.fps(),numFrames:()=>h.numFrames(),stepFrame:_i,drawCalls:()=>p.lastDrawCalls,clearLog:()=>V.logs=[],log:t=>{let n=e.logMax??8;V.logs.unshift({msg:t,time:h.time()}),V.logs.length>n&&(V.logs=V.logs.slice(0,n))},error:e=>vn.log(new Error(e.toString?e.toString():e)),curRecording:null,numObjects:()=>Ki("*",{recursive:!0}).length,get paused(){return An},set paused(e){An=e,e?A.ctx.suspend():A.ctx.resume()}};function yn(){return h.dt()*vn.timeScale}function Vn(...e){return e.length>0&&(V.cam.pos=L(...e)),V.cam.pos?V.cam.pos.clone():Fi()}function xn(...e){return e.length>0&&(V.cam.scale=L(...e)),V.cam.scale.clone()}function En(e){return void 0!==e&&(V.cam.angle=e),V.cam.angle}function bn(e=12){V.cam.shake+=e}function Sn(e){return V.cam.transform.multVec2(e)}function Rn(e){return V.cam.transform.invert().multVec2(e)}function Mn(e){let t=new j;return e.pos&&t.translate(e.pos),e.scale&&t.scale(e.scale),e.angle&&t.rotate(e.angle),e.parent?t.mult(e.parent.transform):t}function kn(e=[]){let t=new Map,n={},i=new Ae,r=[],s=null,o=!1,a={id:Te(),hidden:!1,transform:new j,children:[],parent:null,set paused(e){if(e!==o){o=e;for(let t of r)t.paused=e}},get paused(){return o},add(e=[]){let t=Array.isArray(e)?kn(e):e;if(t.parent)throw new Error("Cannot add a game obj that already has a parent.");return t.parent=this,t.transform=Mn(t),this.children.push(t),t.trigger("add",t),V.events.trigger("add",t),t},readd(e){let t=this.children.indexOf(e);return-1!==t&&(this.children.splice(t,1),this.children.push(e)),e},remove(e){let t=this.children.indexOf(e);if(-1!==t){e.parent=null,this.children.splice(t,1);let n=k((e=>{e.trigger("destroy"),V.events.trigger("destroy",e),e.children.forEach((e=>n(e)))}),"trigger");n(e)}},removeAll(e){if(e)this.get(e).forEach((e=>this.remove(e)));else for(let t of[...this.children])this.remove(t)},update(){this.paused||(this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.update())),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&this.canvas.bind();let e=p.fixed;this.fixed&&(p.fixed=!0),qt(),Nt(this.pos),Gt(this.scale),Ot(this.angle);let t=this.children.sort(((e,t)=>(e.z??0)-(t.z??0)));if(this.mask){let e={intersect:tn,subtract:nn}[this.mask];if(!e)throw new Error(`Invalid mask func: "${this.mask}"`);e((()=>{t.forEach((e=>e.draw()))}),(()=>{this.trigger("draw")}))}else this.trigger("draw"),t.forEach((e=>e.draw()));Ht(),p.fixed=e,this.canvas&&this.canvas.unbind()},drawInspect(){this.hidden||(qt(),Nt(this.pos),Gt(this.scale),Ot(this.angle),this.children.sort(((e,t)=>(e.z??0)-(t.z??0))).forEach((e=>e.drawInspect())),this.trigger("drawInspect"),Ht())},use(e){if(!e)return;if("string"==typeof e)return this.use({id:e});let i=[];e.id&&(this.unuse(e.id),n[e.id]=[],i=n[e.id],t.set(e.id,e));for(let t in e){if(Tt.has(t))continue;let n=Object.getOwnPropertyDescriptor(e,t);if("function"==typeof n.value&&(e[t]=e[t].bind(this)),n.set&&Object.defineProperty(e,t,{set:n.set.bind(this)}),n.get&&Object.defineProperty(e,t,{get:n.get.bind(this)}),It.has(t)){let n="add"===t?()=>{s=k((e=>i.push(e)),"onCurCompCleanup"),e[t](),s=null}:e[t];i.push(this.on(t,n).cancel)}else{if(void 0!==this[t])throw new Error(`Duplicate component property: "${t}"`);Object.defineProperty(this,t,{get:()=>e[t],set:n=>e[t]=n,configurable:!0,enumerable:!0}),i.push((()=>delete this[t]))}}let r=k((()=>{if(e.require)for(let t of e.require)if(!this.c(t))throw new Error(`Component "${e.id}" requires component "${t}"`)}),"checkDeps");e.destroy&&i.push(e.destroy.bind(this)),this.exists()?(r(),e.add&&(s=k((e=>i.push(e)),"onCurCompCleanup"),e.add.call(this),s=null)):e.require&&i.push(this.on("add",r).cancel)},unuse(e){n[e]&&(n[e].forEach((e=>e())),delete n[e]),t.has(e)&&t.delete(e)},c:e=>t.get(e),get(e,t={}){let n=t.recursive?this.children.flatMap(k((function e(t){return[t,...t.children.flatMap(e)]}),"recurse")):this.children;if(n=n.filter((t=>!e||t.is(e))),t.liveUpdate){let i=k((e=>t.recursive?this.isAncestorOf(e):e.parent===this),"isChild"),r=[];r.push(Pn((t=>{i(t)&&t.is(e)&&n.push(t)}))),r.push(Fn((t=>{if(i(t)&&t.is(e)){let e=n.findIndex((e=>e.id===t.id));-1!==e&&n.splice(e,1)}}))),this.onDestroy((()=>{for(let e of r)e.cancel()}))}return n},isAncestorOf(e){return!!e.parent&&(e.parent===this||this.isAncestorOf(e.parent))},exists(){return V.root.isAncestorOf(this)},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this.c(t))return!1;return!0}return null!=this.c(e)},on(e,t){let n=i.on(e,t.bind(this));return s&&s((()=>n.cancel())),n},trigger(e,...t){i.trigger(e,...t),V.objEvents.trigger(e,this,...t)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let e={};for(let[n,i]of t)e[n]=i.inspect?i.inspect():null;return e},onAdd(e){return this.on("add",e)},onUpdate(e){return this.on("update",e)},onDraw(e){return this.on("draw",e)},onDestroy(e){return this.on("destroy",e)},clearEvents(){i.clear()}},l=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let u of l)a[u]=(...e)=>{let t=h[u](...e);return r.push(t),a.onDestroy((()=>t.cancel())),t};for(let h of e)a.use(h);return a}function Tn(e,t,n){return V.objEvents[e]||(V.objEvents[e]=new me),V.objEvents.on(e,((e,...i)=>{e.is(t)&&n(e,...i)}))}k(yn,"dt"),k(Vn,"camPos"),k(xn,"camScale"),k(En,"camRot"),k(bn,"shake"),k(Sn,"toScreen"),k(Rn,"toWorld"),k(Mn,"calcTransform"),k(kn,"make"),k(Tn,"on");let In=ke((e=>{let t=qi([{update:e}]);return{get paused(){return t.paused},set paused(e){t.paused=e},cancel:()=>t.destroy()}}),((e,t)=>Tn("update",e,t))),Bn=ke((e=>{let t=qi([{draw:e}]);return{get paused(){return t.hidden},set paused(e){t.hidden=e},cancel:()=>t.destroy()}}),((e,t)=>Tn("draw",e,t))),Pn=ke((e=>V.events.on("add",e)),((e,t)=>Tn("add",e,t))),Fn=ke((e=>V.events.on("destroy",e)),((e,t)=>Tn("destroy",e,t)));function Cn(e,t,n){return Tn("collide",e,((e,i,r)=>i.is(t)&&n(e,i,r)))}function Dn(e,t,n){return Tn("collideUpdate",e,((e,i,r)=>i.is(t)&&n(e,i,r)))}function Un(e,t,n){return Tn("collideEnd",e,((e,i,r)=>i.is(t)&&n(e,i,r)))}function Ln(e,t){Ki(e,{recursive:!0}).forEach(t),Pn(e,t)}k(Cn,"onCollide"),k(Dn,"onCollideUpdate"),k(Un,"onCollideEnd"),k(Ln,"forAllCurrentAndFuture");let Nn=ke((e=>h.onMousePress(e)),((e,t)=>{let n=[];return Ln(e,(e=>{if(!e.area)throw new Error("onClick() requires the object to have area() component");n.push(e.onClick((()=>t(e))))})),ge.join(n)}));function Gn(e,t){let n=[];return Ln(e,(e=>{if(!e.area)throw new Error("onHover() requires the object to have area() component");n.push(e.onHover((()=>t(e))))})),ge.join(n)}function On(e,t){let n=[];return Ln(e,(e=>{if(!e.area)throw new Error("onHoverUpdate() requires the object to have area() component");n.push(e.onHoverUpdate((()=>t(e))))})),ge.join(n)}function qn(e,t){let n=[];return Ln(e,(e=>{if(!e.area)throw new Error("onHoverEnd() requires the object to have area() component");n.push(e.onHoverEnd((()=>t(e))))})),ge.join(n)}function Hn(e){V.gravity=e}function jn(){return V.gravity}function Kn(...e){1===e.length||2===e.length?(p.bgColor=G(e[0]),e[1]&&(p.bgAlpha=e[1])):(3===e.length||4===e.length)&&(p.bgColor=G(e[0],e[1],e[2]),e[3]&&(p.bgAlpha=e[3])),d.clearColor(p.bgColor.r/255,p.bgColor.g/255,p.bgColor.b/255,p.bgAlpha)}function Yn(){return p.bgColor.clone()}function zn(...e){return{id:"pos",pos:L(...e),moveBy(...e){this.pos=this.pos.add(L(...e))},move(...e){this.moveBy(L(...e).scale(yn()))},moveTo(...e){if("number"==typeof e[0]&&"number"==typeof e[1])return this.moveTo(L(e[0],e[1]),e[2]);let t=e[0],n=e[1];if(void 0===n)return void(this.pos=L(t));let i=t.sub(this.pos);i.len()<=n*yn()?this.pos=L(t):this.move(i.unit().scale(n))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},screenPos(){let e=this.worldPos();return ii(this)?e:Sn(e)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){Zt({color:G(255,0,0),radius:4/rn()})}}}function Qn(...e){return 0===e.length?Qn(1):{id:"scale",scale:L(...e),scaleTo(...e){this.scale=L(...e)},scaleBy(...e){this.scale.scale(L(...e))},inspect(){return`(${Xn(this.scale.x,2)}, ${Xn(this.scale.y,2)})`}}}function Wn(e){return{id:"rotate",angle:e??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`${Math.round(this.angle)}`}}}function Jn(...e){return{id:"color",color:G(...e),inspect(){return this.color.toString()}}}function Xn(e,t){return Number(e.toFixed(t))}function Zn(e){return{id:"opacity",opacity:e??1,inspect(){return`${Xn(this.opacity,1)}`},fadeOut(e=1,t=mt.linear){return Qi(this.opacity,0,e,(e=>this.opacity=e),t)}}}function _n(e){if(!e)throw new Error("Please define an anchor");return{id:"anchor",anchor:e,inspect(){return"string"==typeof this.anchor?this.anchor:this.anchor.toString()}}}function $n(e){return{id:"z",z:e,inspect(){return`${this.z}`}}}function ei(e,t){return{id:"follow",require:["pos"],follow:{obj:e,offset:t??L(0)},add(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){e.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}function ti(e,t){let n="number"==typeof e?U.fromAngle(e):e.unit();return{id:"move",require:["pos"],update(){this.move(n.scale(t))}}}k(Gn,"onHover"),k(On,"onHoverUpdate"),k(qn,"onHoverEnd"),k(Hn,"setGravity"),k(jn,"getGravity"),k(Kn,"setBackground"),k(Yn,"getBackground"),k(zn,"pos"),k(Qn,"scale"),k(Wn,"rotate"),k(Jn,"color"),k(Xn,"toFixed"),k(Zn,"opacity"),k(_n,"anchor"),k($n,"z"),k(ei,"follow"),k(ti,"move");function ni(e={}){let t=e.distance??200,n=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let e=this.screenPos(),n=new ue(L(0),pn(),fn());return!ie(n,e)&&n.sdistToPoint(e)>t*t},onExitScreen(e){return this.on("exitView",e)},onEnterScreen(e){return this.on("enterView",e)},update(){this.isOffScreen()?(n||(this.trigger("exitView"),n=!0),e.hide&&(this.hidden=!0),e.pause&&(this.paused=!0),e.destroy&&this.destroy()):(n&&(this.trigger("enterView"),n=!1),e.hide&&(this.hidden=!1),e.pause&&(this.paused=!1))}}}function ii(e){return!!e.fixed||!!e.parent&&ii(e.parent)}function ri(e={}){let t={},n=new Set;return{id:"area",collisionIgnore:e.collisionIgnore??[],add(){this.area.cursor&&this.onHover((()=>h.setCursor(this.area.cursor))),this.onCollideUpdate(((e,i)=>{t[e.id]||this.trigger("collide",e,i),t[e.id]=i,n.add(e.id)}))},update(){for(let e in t)n.has(Number(e))||(this.trigger("collideEnd",t[e].target),delete t[e]);n.clear()},drawInspect(){let e=this.localArea();qt(),Gt(this.area.scale),Nt(this.area.offset);let t={outline:{width:4/rn(),color:G(0,0,255)},anchor:this.anchor,fill:!1,fixed:ii(this)};e instanceof ue?Qt({...t,pos:e.pos,width:e.width,height:e.height}):e instanceof pe?$t({...t,pts:e.pts}):e instanceof de&&Zt({...t,pos:e.center,radius:e.radius}),Ht()},area:{shape:e.shape??null,scale:e.scale?L(e.scale):L(1),offset:e.offset??L(0),cursor:e.cursor??null},isClicked(){return h.isMousePressed()&&this.isHovering()},isHovering(){let e=ii(this)?wn():Rn(wn());return this.hasPoint(e)},checkCollision:e=>t[e.id]??null,getCollisions:()=>Object.values(t),isColliding:e=>!!t[e.id],isOverlapping(e){let n=t[e.id];return n&&n.hasOverlap()},onClick(e){let t=h.onMousePress("left",(()=>{this.isHovering()&&e()}));return this.onDestroy((()=>t.cancel())),t},onHover(e){let t=!1;return this.onUpdate((()=>{t?t=this.isHovering():this.isHovering()&&(t=!0,e())}))},onHoverUpdate(e){return this.onUpdate((()=>{this.isHovering()&&e()}))},onHoverEnd(e){let t=!1;return this.onUpdate((()=>{t?this.isHovering()||(t=!1,e()):t=this.isHovering()}))},onCollide(e,t){return"function"==typeof e&&void 0===t?this.on("collide",e):"string"==typeof e?this.onCollide(((n,i)=>{n.is(e)&&t(n,i)})):void 0},onCollideUpdate(e,t){return"function"==typeof e&&void 0===t?this.on("collideUpdate",e):"string"==typeof e?this.on("collideUpdate",((n,i)=>n.is(e)&&t(n,i))):void 0},onCollideEnd(e,t){return"function"==typeof e&&void 0===t?this.on("collideEnd",e):"string"==typeof e?this.on("collideEnd",(n=>n.is(e)&&t(n))):void 0},hasPoint(e){return le(this.worldArea(),e)},resolveCollision(e){let t=this.checkCollision(e);t&&!t.resolved&&(this.pos=this.pos.add(t.displacement),t.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let e=this.localArea();if(!(e instanceof pe||e instanceof ue))throw new Error("Only support polygon and rect shapes for now");let t=this.transform.clone().scale(L(this.area.scale??1)).translate(this.area.offset);if(e instanceof ue){let n=Bt(this.anchor||vt).add(1,1).scale(-.5).scale(e.width,e.height);t.translate(n)}return e.transform(t)},screenArea(){let e=this.worldArea();return ii(this)?e:e.transform(V.cam.transform)}}}function si(e){return{color:e.color,opacity:e.opacity,anchor:e.anchor,outline:e.outline,shader:e.shader,uniform:e.uniform}}function oi(e,t={}){let n=null,i=null,r=null,s=new we;if(!e)throw new Error("Please pass the resource name or data to sprite()");let o=k(((e,t,n,i)=>{let r=L(1,1);return n&&i?(r.x=n/(e.width*t.w),r.y=i/(e.height*t.h)):n?(r.x=n/(e.width*t.w),r.y=r.x):i&&(r.y=i/(e.height*t.h),r.x=r.y),r}),"calcTexScale");return{id:"sprite",width:0,height:0,frame:t.frame||0,quad:t.quad||new q(0,0,1,1),animSpeed:t.animSpeed??1,flipX:t.flipX??!1,flipY:t.flipY??!1,draw(){if(!n)return;let e=n.frames[this.frame??0];if(!e)throw new Error(`Frame not found: ${this.frame??0}`);if(n.slice9){let{left:i,right:r,top:s,bottom:o}=n.slice9,a=n.tex.width*e.w,l=n.tex.height*e.h,h=this.width-i-r,u=this.height-s-o,d=i/a,c=r/a,p=1-d-c,f=s/l,m=o/l,g=1-f-m,w=[H(0,0,d,f),H(d,0,p,f),H(d+p,0,c,f),H(0,f,d,g),H(d,f,p,g),H(d+p,f,c,g),H(0,f+g,d,m),H(d,f+g,p,m),H(d+p,f+g,c,m),H(0,0,i,s),H(i,0,h,s),H(i+h,0,r,s),H(0,s,i,u),H(i,s,h,u),H(i+h,s,r,u),H(0,s+u,i,o),H(i,s+u,h,o),H(i+h,s+u,r,o)];for(let A=0;A<9;A++){let i=w[A],r=w[A+9];Kt(Object.assign(si(this),{pos:r.pos(),tex:n.tex,quad:e.scale(i),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:r.w,height:r.h}))}}else Kt(Object.assign(si(this),{tex:n.tex,quad:e.scale(this.quad??new q(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:t.tiled,width:this.width,height:this.height}))},add(){let i=k((e=>{let i=e.frames[0].clone();t.quad&&(i=i.scale(t.quad));let r=o(e.tex,i,t.width,t.height);this.width=e.tex.width*i.w*r.x,this.height=e.tex.height*i.h*r.y,t.anim&&this.play(t.anim),n=e,s.trigger(n)}),"setSpriteData"),r=Ke(e);r?r.onLoad(i):Ri((()=>i(Ke(e).data)))},update(){if(!i)return;let e=n.anims[i.name];if("number"!=typeof e){if(0===e.speed)throw new Error("Sprite anim speed cannot be 0");i.timer+=yn()*this.animSpeed,i.timer>=1/i.speed&&(i.timer=0,this.frame+=r,(this.frame<Math.min(e.from,e.to)||this.frame>Math.max(e.from,e.to))&&(i.loop?i.pingpong?(this.frame-=r,r*=-1,this.frame+=r):this.frame=e.from:(this.frame=e.to,i.onEnd(),this.stop())))}else this.frame=e},play(e,t={}){if(!n)return void s.add((()=>this.play(e,t)));let o=n.anims[e];if(void 0===o)throw new Error(`Anim not found: ${e}`);i&&this.stop(),i="number"==typeof o?{name:e,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:e,timer:0,loop:t.loop??o.loop??!1,pingpong:t.pingpong??o.pingpong??!1,speed:t.speed??o.speed??10,onEnd:t.onEnd??(()=>{})},r="number"==typeof o?null:o.from<o.to?1:-1,this.frame="number"==typeof o?o:o.from,this.trigger("animStart",e)},stop(){if(!i)return;let e=i.name;i=null,this.trigger("animEnd",e)},numFrames:()=>(null==n?void 0:n.frames.length)??0,curAnim:()=>null==i?void 0:i.name,onAnimEnd(e){return this.on("animEnd",e)},onAnimStart(e){return this.on("animStart",e)},renderArea(){return new ue(L(0),this.width,this.height)},inspect(){if("string"==typeof e)return`"${e}"`}}}function ai(e,t={}){function n(e){var n,i;let r=un(Object.assign(si(e),{text:e.text+"",size:e.textSize,font:e.font,width:t.width&&e.width,align:e.align,letterSpacing:e.letterSpacing,lineSpacing:e.lineSpacing,transform:e.textTransform,styles:e.textStyles}));return t.width||(e.width=r.width/((null==(n=e.scale)?void 0:n.x)||1)),e.height=r.height/((null==(i=e.scale)?void 0:i.y)||1),r}k(n,"update");let i={id:"text",set text(t){e=t,n(this)},get text(){return e},textSize:t.size??36,font:t.font,width:t.width??0,height:0,align:t.align,lineSpacing:t.lineSpacing,letterSpacing:t.letterSpacing,textTransform:t.transform,textStyles:t.styles,add(){Ri((()=>n(this)))},draw(){cn(n(this))},renderArea(){return new ue(L(0),this.width,this.height)}};return n(i),i}function li(e,t={}){if(e.length<3)throw new Error(`Polygon's need more than two points, ${e.length} points provided`);return{id:"polygon",pts:e,colors:t.colors,radius:t.radius,draw(){$t(Object.assign(si(this),{pts:this.pts,colors:this.colors,radius:this.radius,fill:t.fill}))},renderArea(){return new pe(this.pts)},inspect(){return this.pts.map((e=>`[${e.x},${e.y}]`)).join(",")}}}function hi(e,t,n={}){return{id:"rect",width:e,height:t,radius:n.radius||0,draw(){Qt(Object.assign(si(this),{width:this.width,height:this.height,radius:this.radius,fill:n.fill}))},renderArea(){return new ue(L(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function ui(e,t){return{id:"rect",width:e,height:t,draw(){jt(Object.assign(si(this),{width:this.width,height:this.height}))},renderArea(){return new ue(L(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}function di(e,t={}){return{id:"circle",radius:e,draw(){Zt(Object.assign(si(this),{radius:this.radius,fill:t.fill}))},renderArea(){return new ue(new U(this.anchor?0:-this.radius),2*this.radius,2*this.radius)},inspect(){return`${Math.ceil(this.radius)}`}}}function ci(e=1,t=G(0,0,0)){return{id:"outline",outline:{width:e,color:t}}}function pi(){return{id:"timer",wait(e,t){let n=[];t&&n.push(t);let i=0,r=this.onUpdate((()=>{i+=yn(),i>=e&&(n.forEach((e=>e())),r.cancel())}));return{get paused(){return r.paused},set paused(e){r.paused=e},cancel:r.cancel,onEnd(e){n.push(e)},then(e){return this.onEnd(e),this}}},loop(e,t){let n=null,i=k((()=>{n=this.wait(e,i),t()}),"newAction");return n=this.wait(0,i),{get paused(){return n.paused},set paused(e){n.paused=e},cancel:()=>n.cancel()}},tween(e,t,n,i,r=mt.linear){let s=0,o=[],a=this.onUpdate((()=>{s+=yn();let l=Math.min(s/n,1);i(F(e,t,r(l))),1===l&&(a.cancel(),i(t),o.forEach((e=>e())))}));return{get paused(){return a.paused},set paused(e){a.paused=e},onEnd(e){o.push(e)},then(e){return this.onEnd(e),this},cancel(){a.cancel()},finish(){a.cancel(),i(t),o.forEach((e=>e()))}}}}}k(ni,"offscreen"),k(ii,"isFixed"),k(ri,"area"),k(si,"getRenderProps"),k(oi,"sprite"),k(ai,"text"),k(li,"polygon"),k(hi,"rect"),k(ui,"uvquad"),k(di,"circle"),k(ci,"outline"),k(pi,"timer");let fi;function mi(e={}){let t=null,n=null,i=!1;return{id:"body",require:["pos","area"],vel:new U(0),jumpForce:e.jumpForce??640,gravityScale:e.gravityScale??1,isStatic:e.isStatic??!1,mass:e.mass??1,add(){if(0===this.mass)throw new Error("Can't set body mass to 0");this.onCollideUpdate(((e,t)=>{if(e.is("body")&&!t.resolved&&(this.trigger("beforePhysicsResolve",t),e.trigger("beforePhysicsResolve",t.reverse()),!(t.resolved||this.isStatic&&e.isStatic))){if(this.isStatic||e.isStatic){let n=!this.isStatic&&e.isStatic?t:t.reverse();n.source.pos=n.source.pos.add(n.displacement),n.source.transform=Mn(n.source)}else{let n=this.mass+e.mass;this.pos=this.pos.add(t.displacement.scale(e.mass/n)),e.pos=e.pos.add(t.displacement.scale(-this.mass/n)),this.transform=Mn(this),e.transform=Mn(e)}t.resolved=!0,this.trigger("physicsResolve",t),e.trigger("physicsResolve",t.reverse())}})),this.onPhysicsResolve((e=>{V.gravity&&(e.isBottom()&&this.isFalling()?(this.vel.y=0,t=e.target,n=e.target.pos,i?i=!1:this.trigger("ground",t)):e.isTop()&&this.isJumping()&&(this.vel.y=0,this.trigger("headbutt",e.target)))}))},update(){if(!V.gravity||this.isStatic)return;if(i&&(t=null,n=null,this.trigger("fallOff"),i=!1),t){if(this.isColliding(t)&&t.exists()&&t.is("body"))return!t.pos.eq(n)&&!1!==e.stickToPlatform&&this.moveBy(t.pos.sub(n)),void(n=t.pos);i=!0}let r=this.vel.y;this.vel.y+=V.gravity*this.gravityScale*yn(),this.vel.y=Math.min(this.vel.y,e.maxVelocity??65536),r<0&&this.vel.y>=0&&this.trigger("fall"),this.move(this.vel)},onPhysicsResolve(e){return this.on("physicsResolve",e)},onBeforePhysicsResolve(e){return this.on("beforePhysicsResolve",e)},curPlatform:()=>t,isGrounded:()=>null!==t,isFalling(){return this.vel.y>0},isJumping(){return this.vel.y<0},jump(e){t=null,n=null,this.vel.y=-e||-this.jumpForce},onGround(e){return this.on("ground",e)},onFall(e){return this.on("fall",e)},onFallOff(e){return this.on("fallOff",e)},onHeadbutt(e){return this.on("headbutt",e)}}}function gi(e=2){let t=e;return{id:"doubleJump",require:["body"],numJumps:e,add(){this.onGround((()=>{t=this.numJumps}))},doubleJump(e){t<=0||(t<this.numJumps&&this.trigger("doubleJump"),t--,this.jump(e))},onDoubleJump(e){return this.on("doubleJump",e)},inspect:()=>`${t}`}}function wi(e,t){return{id:"shader",shader:e,..."function"==typeof t?{uniform:t(),update(){this.uniform=t()}}:{uniform:t}}}function Ai(){return{id:"fixed",fixed:!0}}function vi(e){return{id:"stay",stay:!0,scenesToStay:e}}function yi(e,t){if(null==e)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(t=1){this.setHP(e-t),this.trigger("hurt",t)},heal(t=1){let n=e;this.setHP(e+t),this.trigger("heal",e-n)},hp:()=>e,maxHP:()=>t??null,setMaxHP(e){t=e},setHP(n){(e=t?Math.min(t,n):n)<=0&&this.trigger("death")},onHurt(e){return this.on("hurt",e)},onHeal(e){return this.on("heal",e)},onDeath(e){return this.on("death",e)},inspect:()=>`${e}`}}function Vi(e,t={}){if(null==e)throw new Error("lifespan() requires time");let n=t.fade??0;return{id:"lifespan",async add(){await Yi(e),n>0&&this.opacity&&await Qi(this.opacity,0,n,(e=>this.opacity=e),mt.linear),this.destroy()}}}function xi(e,t,n){if(!e)throw new Error("state() requires an initial state");let i={};function r(e){i[e]||(i[e]={enter:new we,end:new we,update:new we,draw:new we})}function s(e,t,n){return r(t),i[t][e].add(n)}function o(e,t,...n){r(t),i[t][e].trigger(...n)}k(r,"initStateEvents"),k(s,"on"),k(o,"trigger");let a=!1;return{id:"state",state:e,enterState(e,...i){if(a=!0,t&&!t.includes(e))throw new Error(`State not found: ${e}`);let r=this.state;if(n){if(!(null==n?void 0:n[r]))return;let t="string"==typeof n[r]?[n[r]]:n[r];if(!t.includes(e))throw new Error(`Cannot transition state from "${r}" to "${e}". Available transitions: ${t.map((e=>`"${e}"`)).join(", ")}`)}o("end",r,...i),this.state=e,o("enter",e,...i),o("enter",`${r} -> ${e}`,...i)},onStateTransition:(e,t,n)=>s("enter",`${e} -> ${t}`,n),onStateEnter:(e,t)=>s("enter",e,t),onStateUpdate:(e,t)=>s("update",e,t),onStateDraw:(e,t)=>s("draw",e,t),onStateEnd:(e,t)=>s("end",e,t),update(){a||(o("enter",e),a=!0),o("update",this.state)},draw(){o("draw",this.state)},inspect(){return this.state}}}function Ei(e=1){let t=0,n=!1;return{require:["opacity"],add(){this.opacity=0},update(){n||(t+=yn(),this.opacity=C(t,0,e,0,1),t>=e&&(this.opacity=1,n=!0))}}}function bi(e="intersect"){return{id:"mask",mask:e}}function Si(e){return{add(){this.canvas=e}}}function Ri(e){v.loaded?e():V.events.on("load",e)}function Mi(e,t){V.scenes[e]=t}function ki(e,...t){if(!V.scenes[e])throw new Error(`Scene not found: ${e}`);V.events.onOnce("frameEnd",(()=>{V.events.trigger("sceneLeave",e),h.events.clear(),V.events.clear(),V.objEvents.clear(),[...V.root.children].forEach((t=>{(!t.stay||t.scenesToStay&&!t.scenesToStay.includes(e))&&V.root.remove(t)})),V.root.clearEvents(),fr(),V.cam={pos:null,scale:L(1),angle:0,shake:0,transform:new j},V.scenes[e](...t)}))}function Ti(e){return V.events.on("sceneLeave",e)}function Ii(e,t){try{return JSON.parse(window.localStorage[e])}catch{return t?(Bi(e,t),t):null}}function Bi(e,t){window.localStorage[e]=JSON.stringify(t)}function Pi(t,...n){let i,r=t(mr);i="function"==typeof r?r(...n)(mr):r;for(let s in i)mr[s]=i[s],!1!==e.global&&(window[s]=i[s]);return mr}function Fi(){return L(pn()/2,fn()/2)}var Ci;function Di(e={}){let t=L(0),n=e.isObstacle??!1,i=e.cost??0,r=e.edges??[],s=k((()=>{let e={left:1,top:2,right:4,bottom:8};return r.map((t=>e[t]||0)).reduce(((e,t)=>e|t),0)}),"getEdgeMask"),o=s();return{id:"tile",tilePosOffset:e.offset??L(0),set tilePos(e){let n=this.getLevel();t=e.clone(),this.pos=L(this.tilePos.x*n.tileWidth(),this.tilePos.y*n.tileHeight()).add(this.tilePosOffset)},get tilePos(){return t},set isObstacle(e){n!==e&&(n=e,this.getLevel().invalidateNavigationMap())},get isObstacle(){return n},set cost(e){i!==e&&(i=e,this.getLevel().invalidateNavigationMap())},get cost(){return i},set edges(e){r=e,o=s(),this.getLevel().invalidateNavigationMap()},get edges(){return r},get edgeMask(){return o},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(L(-1,0))},moveRight(){this.tilePos=this.tilePos.add(L(1,0))},moveUp(){this.tilePos=this.tilePos.add(L(0,-1))},moveDown(){this.tilePos=this.tilePos.add(L(0,1))}}}function Ui(e,t){if(!t.tileWidth||!t.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let n=qi([zn(t.pos??L(0))]),i=e.length,r=0,s=null,o=null,a=null,l=null,h=k((e=>e.x+e.y*r),"tile2Hash"),u=k((e=>L(Math.floor(e%r),Math.floor(e/r))),"hash2Tile"),d=k((()=>{s=[];for(let e of n.children)c(e)}),"createSpatialMap"),c=k((e=>{let t=h(e.tilePos);s[t]?s[t].push(e):s[t]=[e]}),"insertIntoSpatialMap"),p=k((e=>{let t=h(e.tilePos);if(s[t]){let n=s[t].indexOf(e);n>=0&&s[t].splice(n,1)}}),"removeFromSpatialMap"),f=k((()=>{let e=!1;for(let t of n.children){let i=n.pos2Tile(t.pos);(t.tilePos.x!=i.x||t.tilePos.y!=i.y)&&(e=!0,p(t),t.tilePos.x=i.x,t.tilePos.y=i.y,c(t))}e&&n.trigger("spatial_map_changed")}),"updateSpatialMap"),m=k((()=>{let e=n.getSpatialMap(),t=n.numRows()*n.numColumns();o?o.length=t:o=new Array(t),o.fill(1,0,t);for(let n=0;n<e.length;n++){let t=e[n];if(t){let e=0;for(let n of t){if(n.isObstacle){e=1/0;break}e+=n.cost}o[n]=e||1}}}),"createCostMap"),g=k((()=>{let e=n.getSpatialMap(),t=n.numRows()*n.numColumns();a?a.length=t:a=new Array(t),a.fill(15,0,t);for(let n=0;n<e.length;n++){let t=e[n];if(t){let e=t.length,i=15;for(let n=0;n<e;n++)i|=t[n].edgeMask;a[n]=i}}}),"createEdgeMap"),w=k((()=>{let e=n.numRows()*n.numColumns(),t=k(((e,t)=>{let n=[];for(n.push(e);n.length>0;){let e=n.pop();y(e).forEach((e=>{l[e]<0&&(l[e]=t,n.push(e))}))}}),"traverse");l?l.length=e:l=new Array(e),l.fill(-1,0,e);let i=0;for(let n=0;n<o.length;n++)l[n]>=0||t(n,i),i++}),"createConnectivityMap"),A=k(((e,t)=>o[t]),"getCost"),v=k(((e,t)=>{let n=u(e),i=u(t);return n.dist(i)}),"getHeuristic"),y=k(((e,t)=>{let n=[],s=Math.floor(e%r),l=s>0&&1&a[e]&&o[e-1]!==1/0,h=e>=r&&2&a[e]&&o[e-r]!==1/0,u=s<r-1&&4&a[e]&&o[e+1]!==1/0,d=e<r*i-r-1&&8&a[e]&&o[e+r]!==1/0;return t?(l&&(h&&n.push(e-r-1),n.push(e-1),d&&n.push(e+r-1)),h&&n.push(e-r),u&&(h&&n.push(e-r+1),n.push(e+1),d&&n.push(e+r+1)),d&&n.push(e+r)):(l&&n.push(e-1),h&&n.push(e-r),u&&n.push(e+1),d&&n.push(e+r)),n}),"getNeighbours"),V={id:"level",tileWidth:()=>t.tileWidth,tileHeight:()=>t.tileHeight,spawn(e,...i){let r=L(...i),o=(()=>{if("string"!=typeof e){if(Array.isArray(e))return e;throw new Error("Expected a symbol or a component list")}if(t.tiles[e]){if("function"!=typeof t.tiles[e])throw new Error("Level symbol def must be a function returning a component list");return t.tiles[e](r)}if(t.wildcardTile)return t.wildcardTile(e,r)})();if(!o)return null;let a=!1,l=!1;for(let t of o)"tile"===t.id&&(l=!0),"pos"===t.id&&(a=!0);a||o.push(zn()),l||o.push(Di());let h=n.add(o);return a&&(h.tilePosOffset=h.pos.clone()),h.tilePos=r,s&&(c(h),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),h},numColumns:()=>r,numRows:()=>i,levelWidth(){return r*this.tileWidth()},levelHeight(){return i*this.tileHeight()},tile2Pos(...e){return L(...e).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...e){let t=L(...e);return L(Math.floor(t.x/this.tileWidth()),Math.floor(t.y/this.tileHeight()))},getSpatialMap:()=>(s||d(),s),onSpatialMapChanged(e){return this.on("spatial_map_changed",e)},onNavigationMapInvalid(e){return this.on("navigation_map_invalid",e)},getAt(e){s||d();let t=h(e);return s[t]||[]},update(){s&&f()},invalidateNavigationMap(){o=null,a=null,l=null},onNavigationMapChanged(e){return this.on("navigation_map_changed",e)},getTilePath(e,t,n={}){var s;if(o||m(),a||g(),l||w(),e.x<0||e.x>=r||e.y<0||e.y>=i||t.x<0||t.x>=r||t.y<0||t.y>=i)return null;let d=h(e),c=h(t);if(o[c]===1/0)return null;if(d===c)return[];if(-1!=l[d]&&l[d]!==l[c])return null;let p=new Be(((e,t)=>e.cost<t.cost));p.insert({cost:0,node:d});let f=new Map;f.set(d,d);let V=new Map;for(V.set(d,0);0!==p.length;){let e=null==(s=p.remove())?void 0:s.node;if(e===c)break;let t=y(e,n.allowDiagonals);for(let n of t){let t=(V.get(e)||0)+A(e,n)+v(n,c);(!V.has(n)||t<V.get(n))&&(V.set(n,t),p.insert({cost:t,node:n}),f.set(n,e))}}let x=[],E=c,b=u(E);for(x.push(b);E!==d;){E=f.get(E);let e=u(E);x.push(e)}return x.reverse()},getPath(e,t,n={}){let i=this.tileWidth(),r=this.tileHeight(),s=this.getTilePath(this.pos2Tile(e),this.pos2Tile(t),n);return s?[e,...s.slice(1,-1).map((e=>e.scale(i,r).add(i/2,r/2))),t]:null}};return n.use(V),n.onNavigationMapInvalid((()=>{n.invalidateNavigationMap(),n.trigger("navigation_map_changed")})),e.forEach(((e,t)=>{let i=e.split("");r=Math.max(i.length,r),i.forEach(((e,i)=>{n.spawn(e,L(i,t))}))})),n}function Li(e={}){let t=null,n=null,i=null,r=null;return{id:"agent",require:["pos","tile"],agentSpeed:e.speed??100,allowDiagonals:e.allowDiagonals??!0,getDistanceToTarget(){return t?this.pos.dist(t):0},getNextLocation:()=>n&&i?n[i]:null,getPath:()=>n?n.slice():null,getTarget:()=>t,isNavigationFinished:()=>!n||null===i,isTargetReachable:()=>null!==n,isTargetReached(){return!t||this.pos.eq(t)},setTarget(e){t=e,n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),i=n?0:null,n?(r||(r=this.getLevel().onNavigationMapChanged((()=>{n&&null!==i&&(n=this.getLevel().getPath(this.pos,t,{allowDiagonals:this.allowDiagonals}),i=n?0:null,n?this.trigger("navigation-next",this,n[i]):this.trigger("navigation-ended",this))})),this.onDestroy((()=>r.cancel()))),this.trigger("navigation-started",this),this.trigger("navigation-next",this,n[i])):this.trigger("navigation-ended",this)},update(){if(n&&null!==i){if(this.pos.sdist(n[i])<2){if(i===n.length-1)return this.pos=t.clone(),i=null,this.trigger("navigation-ended",this),void this.trigger("target-reached",this);i++,this.trigger("navigation-next",this,n[i])}this.moveTo(n[i],this.agentSpeed)}},onNavigationStarted(e){return this.on("navigation-started",e)},onNavigationNext(e){return this.on("navigation-next",e)},onNavigationEnded(e){return this.on("navigation-ended",e)},onTargetReached(e){return this.on("target-reached",e)},inspect:()=>JSON.stringify({target:JSON.stringify(t),path:JSON.stringify(n)})}}function Ni(e){let t=h.canvas.captureStream(e),n=A.ctx.createMediaStreamDestination();A.masterNode.connect(n);let i=new MediaRecorder(t),r=[];return i.ondataavailable=e=>{e.data.size>0&&r.push(e.data)},i.onerror=()=>{A.masterNode.disconnect(n),t.getTracks().forEach((e=>e.stop()))},i.start(),{resume(){i.resume()},pause(){i.pause()},stop:()=>(i.stop(),A.masterNode.disconnect(n),t.getTracks().forEach((e=>e.stop())),new Promise((e=>{i.onstop=()=>{e(new Blob(r,{type:"video/mp4"}))}}))),download(e="kaboom.mp4"){this.stop().then((t=>Se(e,t)))}}}function Gi(){return document.activeElement===h.canvas}function Oi(e){e.destroy()}k(mi,"body"),k(gi,"doubleJump"),k(wi,"shader"),k(Ai,"fixed"),k(vi,"stay"),k(yi,"health"),k(Vi,"lifespan"),k(xi,"state"),k(Ei,"fadeIn"),k(bi,"mask"),k(Si,"drawon"),k(Ri,"onLoad"),k(Mi,"scene"),k(ki,"go"),k(Ti,"onSceneLeave"),k(Ii,"getData"),k(Bi,"setData"),k(Pi,"plug"),k(Fi,"center"),(Ci=fi||(fi={}))[Ci.None=0]="None",Ci[Ci.Left=1]="Left",Ci[Ci.Top=2]="Top",Ci[Ci.LeftTop=3]="LeftTop",Ci[Ci.Right=4]="Right",Ci[Ci.Horizontal=5]="Horizontal",Ci[Ci.RightTop=6]="RightTop",Ci[Ci.HorizontalTop=7]="HorizontalTop",Ci[Ci.Bottom=8]="Bottom",Ci[Ci.LeftBottom=9]="LeftBottom",Ci[Ci.Vertical=10]="Vertical",Ci[Ci.LeftVertical=11]="LeftVertical",Ci[Ci.RightBottom=12]="RightBottom",Ci[Ci.HorizontalBottom=13]="HorizontalBottom",Ci[Ci.RightVertical=14]="RightVertical",Ci[Ci.All=15]="All",k(Di,"tile"),k(Ui,"addLevel"),k(Li,"agent"),k(Ni,"record"),k(Gi,"isFocused"),k(Oi,"destroy");let qi=V.root.add.bind(V.root),Hi=V.root.readd.bind(V.root),ji=V.root.removeAll.bind(V.root),Ki=V.root.get.bind(V.root),Yi=V.root.wait.bind(V.root),zi=V.root.loop.bind(V.root),Qi=V.root.tween.bind(V.root);function Wi(e=2,t=1){let n=0;return{require:["scale"],update(){let i=Math.sin(n*e)*t;i<0&&this.destroy(),this.scale=L(i),n+=yn()}}}k(Wi,"boom");let Ji=ve(null,"data:image/png;base64,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"),Xi=ve(null,"data:image/png;base64,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");function Zi(e,t={}){let n=qi([zn(e),vi()]),i=5*(t.speed||1),r=t.scale||1;n.add([oi(Xi),Qn(0),_n("center"),Wi(i,r),...t.comps??[]]);let s=n.add([oi(Ji),Qn(0),_n("center"),pi(),...t.comps??[]]);return s.wait(.4/i,(()=>s.use(Wi(i,r)))),s.onDestroy((()=>n.destroy())),n}function _i(){V.root.update()}k(Zi,"addKaboom"),k(_i,"updateFrame");const $i=class e{constructor(e,t,n,i=!1){R(this,"source"),R(this,"target"),R(this,"displacement"),R(this,"resolved",!1),this.source=e,this.target=t,this.displacement=n,this.resolved=i}reverse(){return new e(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.x>0}isRight(){return this.displacement.x<0}isTop(){return this.displacement.y>0}isBottom(){return this.displacement.y<0}preventResolution(){this.resolved=!0}};k($i,"Collision");let er=$i;function tr(){let t={},n=e.hashGridSize||64,i=new j,r=[];function s(e){if(r.push(i.clone()),e.pos&&i.translate(e.pos),e.scale&&i.scale(e.scale),e.angle&&i.rotate(e.angle),e.transform=i.clone(),e.c("area")&&!e.paused){let i=e,r=i.worldArea().bbox(),s=Math.floor(r.pos.x/n),o=Math.floor(r.pos.y/n),a=Math.ceil((r.pos.x+r.width)/n),l=Math.ceil((r.pos.y+r.height)/n),h=new Set;for(let e=s;e<=a;e++)for(let n=o;n<=l;n++)if(t[e])if(t[e][n]){let r=t[e][n];e:for(let e of r){if(e.paused||!e.exists()||h.has(e.id))continue;for(let n of i.collisionIgnore)if(e.is(n))continue e;for(let n of e.collisionIgnore)if(i.is(n))continue e;let t=fe(i.worldArea(),e.worldArea());if(t){let n=new er(i,e,t);i.trigger("collideUpdate",e,n);let r=n.reverse();r.resolved=n.resolved,e.trigger("collideUpdate",i,r)}h.add(e.id)}r.push(i)}else t[e][n]=[i];else t[e]={},t[e][n]=[i]}e.children.forEach(s),i=r.pop()}k(s,"checkObj"),s(V.root)}function nr(){let e=V.cam,t=U.fromAngle(J(0,360)).scale(e.shake);e.shake=F(e.shake,0,5*yn()),e.transform=(new j).translate(Fi()).scale(e.scale).rotate(e.angle).translate((e.pos??Fi()).scale(-1).add(t)),V.root.draw(),pt()}function ir(){let e=E();V.events.numListeners("loading")>0?V.events.trigger("loading",e):sn((()=>{let t=pn()/2,n=L(pn()/2,fn()/2).sub(L(t/2,12));Qt({pos:L(0),width:pn(),height:fn(),color:G(0,0,0)}),Qt({pos:n,width:t,height:24,fill:!1,outline:{width:4}}),Qt({pos:n,width:t*e,height:24})}))}function rr(e,t){sn((()=>{let n=L(8);qt(),Nt(e);let i=un({text:t,font:yt,size:16,pos:n,color:G(255,255,255),fixed:!0}),r=i.width+2*n.x,s=i.height+2*n.x;e.x+r>=pn()&&Nt(L(-r,0)),e.y+s>=fn()&&Nt(L(0,-s)),Qt({width:r,height:s,color:G(0,0,0),radius:4,opacity:.8,fixed:!0}),cn(i),Ht()}))}function sr(){if(vn.inspect){let e=null;for(let t of V.root.get("*",{recursive:!0}))if(t.c("area")&&t.isHovering()){e=t;break}if(V.root.drawInspect(),e){let t=[],n=e.inspect();for(let e in n)n[e]?t.push(`${e}: ${n[e]}`):t.push(`${e}`);rr(gn(wn()),t.join("\n"))}rr(L(8),`FPS: ${vn.fps()}`)}vn.paused&&sn((()=>{qt(),Nt(pn(),0),Nt(-8,8);Qt({width:32,height:32,anchor:"topright",color:G(0,0,0),opacity:.8,radius:4,fixed:!0});for(let e=1;e<=2;e++)Qt({width:4,height:19.2,anchor:"center",pos:L(-32/3*e,16),color:G(255,255,255),radius:2,fixed:!0});Ht()})),1!==vn.timeScale&&sn((()=>{qt(),Nt(pn(),fn()),Nt(-8,-8);let e=un({text:vn.timeScale.toFixed(1),font:yt,size:16,color:G(255,255,255),pos:L(-8),anchor:"botright",fixed:!0});Qt({width:e.width+16+32,height:e.height+16,anchor:"botright",color:G(0,0,0),opacity:.8,radius:4,fixed:!0});for(let t=0;t<2;t++){let n=vn.timeScale<1;Xt({p1:L(-e.width-8*(n?2:3.5),-8),p2:L(-e.width-8*(n?2:3.5),-8-e.height),p3:L(-e.width-8*(n?3.5:2),-8-e.height/2),pos:L(8*-t*1+(n?-4:0),0),color:G(255,255,255),fixed:!0})}cn(e),Ht()})),vn.curRecording&&sn((()=>{qt(),Nt(0,fn()),Nt(24,-24),Zt({radius:12,color:G(255,0,0),opacity:K(0,1,4*h.time()),fixed:!0}),Ht()})),vn.showLog&&V.logs.length>0&&sn((()=>{var t;qt(),Nt(0,fn()),Nt(8,-8);let n=[];for(let e of V.logs){let i="",r=e.msg instanceof Error?"error":"info";i+=`[time]${e.time.toFixed(2)}[/time]`,i+=" ",i+=`[${r}]${(null==(t=e.msg)?void 0:t.toString)?e.msg.toString():e.msg}[/${r}]`,n.push(i)}V.logs=V.logs.filter((t=>h.time()-t.time<(e.logTime||4)));let i=un({text:n.join("\n"),font:yt,pos:L(8,-8),anchor:"botleft",size:16,width:.6*pn(),lineSpacing:4,fixed:!0,styles:{time:{color:G(127,127,127)},info:{color:G(255,255,255)},error:{color:G(255,0,127)}}});Qt({width:i.width+16,height:i.height+16,anchor:"botleft",color:G(0,0,0),radius:4,opacity:.8,fixed:!0}),cn(i),Ht()}))}function or(e){V.events.on("loading",e)}function ar(e){h.onResize(e)}function lr(e){V.events.on("error",e)}function hr(e){console.error(e),A.ctx.suspend(),h.run((()=>{ft(),sn((()=>{let t=pn(),n=fn(),i={size:36,width:t-64,letterSpacing:4,lineSpacing:4,font:yt,fixed:!0};Qt({width:t,height:n,color:G(0,0,255),fixed:!0});let r=un({...i,text:"Error",pos:L(32),color:G(255,128,0),fixed:!0});cn(r),dn({...i,text:e.message,pos:L(32,32+r.height+16),fixed:!0}),Ht(),V.events.trigger("error",e)})),Dt()}))}function ur(e){u.push(e)}function dr(){V.events.onOnce("frameEnd",(()=>{h.quit(),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);let e=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS);for(let t=0;t<e;t++)d.activeTexture(d.TEXTURE0+t),d.bindTexture(d.TEXTURE_2D,null),d.bindTexture(d.TEXTURE_CUBE_MAP,null);d.bindBuffer(d.ARRAY_BUFFER,null),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null),d.bindRenderbuffer(d.RENDERBUFFER,null),d.bindFramebuffer(d.FRAMEBUFFER,null),c.destroy(),u.forEach((e=>e()))}))}k(tr,"checkFrame"),k(nr,"drawFrame"),k(ir,"drawLoadScreen"),k(rr,"drawInspectText"),k(sr,"drawDebug"),k(or,"onLoading"),k(ar,"onResize"),k(lr,"onError"),k(hr,"handleErr"),k(ur,"onCleanup"),k(dr,"quit");let cr=!0;function pr(){let t=o,n=d.drawingBufferWidth/t,i=d.drawingBufferHeight/t;if(e.letterbox){if(!e.width||!e.height)throw new Error("Letterboxing requires width and height defined.");let t=n/i,r=e.width/e.height;if(t>r){let e=i*r,t=(n-e)/2;p.viewport={x:t,y:0,width:e,height:i}}else{let e=n/r,t=(i-e)/2;p.viewport={x:0,y:t,width:n,height:e}}}else{if(e.stretch&&(!e.width||!e.height))throw new Error("Stretching requires width and height defined.");p.viewport={x:0,y:0,width:n,height:i}}}function fr(){h.onHide((()=>{e.backgroundAudio||A.ctx.suspend()})),h.onShow((()=>{!e.backgroundAudio&&!vn.paused&&A.ctx.resume()})),h.onResize((()=>{if(h.isFullscreen())return;let t=e.width&&e.height;t&&!e.stretch&&!e.letterbox||(n.width=n.offsetWidth*o,n.height=n.offsetHeight*o,pr(),t||(p.frameBuffer.free(),p.frameBuffer=new _e(c,d.drawingBufferWidth,d.drawingBufferHeight),p.width=d.drawingBufferWidth/o,p.height=d.drawingBufferHeight/o))})),!1!==e.debug&&(h.onKeyPress("f1",(()=>vn.inspect=!vn.inspect)),h.onKeyPress("f2",(()=>vn.clearLog())),h.onKeyPress("f8",(()=>vn.paused=!vn.paused)),h.onKeyPress("f7",(()=>{vn.timeScale=Xn(P(vn.timeScale-.2,0,2),1)})),h.onKeyPress("f9",(()=>{vn.timeScale=Xn(P(vn.timeScale+.2,0,2),1)})),h.onKeyPress("f10",(()=>vn.stepFrame()))),e.burp&&h.onKeyPress("b",(()=>tt()))}h.run((()=>{try{v.loaded||1===E()&&!cr&&(v.loaded=!0,V.events.trigger("load")),!v.loaded&&!1!==e.loadingScreen||cr?(ft(),ir(),Dt()):(vn.paused||_i(),tr(),ft(),nr(),!1!==e.debug&&sr(),Dt()),cr&&(cr=!1),V.events.trigger("frameEnd")}catch(t){hr(t)}})),k(pr,"updateViewport"),k(fr,"initEvents"),pr(),fr();let mr={VERSION:"3000.1.17",loadRoot:b,loadProgress:E,loadSprite:ve,loadSpriteAtlas:oe,loadSound:Ue,loadBitmapFont:Q,loadFont:Y,loadShader:Ce,loadShaderURL:De,loadAseprite:Pe,loadPedit:ye,loadBean:Le,loadJSON:S,load:x,getSprite:Ne,getSound:Ge,getFont:Oe,getBitmapFont:qe,getShader:He,getAsset:je,Asset:it,SpriteData:m,SoundData:w,width:pn,height:fn,center:Fi,dt:yn,time:h.time,screenshot:h.screenshot,record:Ni,isFocused:Gi,setCursor:h.setCursor,getCursor:h.getCursor,setCursorLocked:h.setCursorLocked,isCursorLocked:h.isCursorLocked,setFullscreen:h.setFullscreen,isFullscreen:h.isFullscreen,isTouchscreen:h.isTouchscreen,onLoad:Ri,onLoading:or,onResize:ar,onGamepadConnect:h.onGamepadConnect,onGamepadDisconnect:h.onGamepadDisconnect,onError:lr,onCleanup:ur,camPos:Vn,camScale:xn,camRot:En,shake:bn,toScreen:Sn,toWorld:Rn,setGravity:Hn,getGravity:jn,setBackground:Kn,getBackground:Yn,getGamepads:h.getGamepads,add:qi,make:kn,destroy:Oi,destroyAll:ji,get:Ki,readd:Hi,pos:zn,scale:Qn,rotate:Wn,color:Jn,opacity:Zn,anchor:_n,area:ri,sprite:oi,text:ai,polygon:li,rect:hi,circle:di,uvquad:ui,outline:ci,body:mi,doubleJump:gi,shader:wi,timer:pi,fixed:Ai,stay:vi,health:yi,lifespan:Vi,z:$n,move:ti,offscreen:ni,follow:ei,state:xi,fadeIn:Ei,mask:bi,drawon:Si,tile:Di,agent:Li,on:Tn,onUpdate:In,onDraw:Bn,onAdd:Pn,onDestroy:Fn,onClick:Nn,onCollide:Cn,onCollideUpdate:Dn,onCollideEnd:Un,onHover:Gn,onHoverUpdate:On,onHoverEnd:qn,onKeyDown:h.onKeyDown,onKeyPress:h.onKeyPress,onKeyPressRepeat:h.onKeyPressRepeat,onKeyRelease:h.onKeyRelease,onMouseDown:h.onMouseDown,onMousePress:h.onMousePress,onMouseRelease:h.onMouseRelease,onMouseMove:h.onMouseMove,onCharInput:h.onCharInput,onTouchStart:h.onTouchStart,onTouchMove:h.onTouchMove,onTouchEnd:h.onTouchEnd,onScroll:h.onScroll,onHide:h.onHide,onShow:h.onShow,onGamepadButtonDown:h.onGamepadButtonDown,onGamepadButtonPress:h.onGamepadButtonPress,onGamepadButtonRelease:h.onGamepadButtonRelease,onGamepadStick:h.onGamepadStick,mousePos:wn,mouseDeltaPos:h.mouseDeltaPos,isKeyDown:h.isKeyDown,isKeyPressed:h.isKeyPressed,isKeyPressedRepeat:h.isKeyPressedRepeat,isKeyReleased:h.isKeyReleased,isMouseDown:h.isMouseDown,isMousePressed:h.isMousePressed,isMouseReleased:h.isMouseReleased,isMouseMoved:h.isMouseMoved,isGamepadButtonPressed:h.isGamepadButtonPressed,isGamepadButtonDown:h.isGamepadButtonDown,isGamepadButtonReleased:h.isGamepadButtonReleased,getGamepadStick:h.getGamepadStick,charInputted:h.charInputted,loop:zi,wait:Yi,play:Je,volume:We,burp:tt,audioCtx:A.ctx,Line:he,Rect:ue,Circle:de,Polygon:pe,Vec2:U,Color:N,Mat4:j,Quad:q,RNG:z,rand:J,randi:X,randSeed:W,vec2:L,rgb:G,hsl2rgb:O,quad:H,choose:_,chance:Z,lerp:F,tween:Qi,easings:mt,map:C,mapc:D,wave:K,deg2rad:I,rad2deg:B,clamp:P,testLineLine:te,testRectRect:$,testRectLine:ne,testRectPoint:ie,testCirclePolygon:ae,testLinePoint:re,testLineCircle:se,drawSprite:Yt,drawText:dn,formatText:un,drawRect:Qt,drawLine:Wt,drawLines:Jt,drawTriangle:Xt,drawCircle:Zt,drawEllipse:_t,drawUVQuad:jt,drawPolygon:$t,drawFormattedText:cn,drawMasked:tn,drawSubtracted:nn,pushTransform:qt,popTransform:Ht,pushTranslate:Nt,pushScale:Gt,pushRotate:Ot,pushMatrix:Lt,usePostEffect:Ct,makeCanvas:st,debug:vn,scene:Mi,go:ki,onSceneLeave:Ti,addLevel:Ui,getData:Ii,setData:Bi,download:xe,downloadJSON:be,downloadText:Ee,downloadBlob:Se,plug:Pi,ASCII_CHARS:At,canvas:h.canvas,addKaboom:Zi,LEFT:U.LEFT,RIGHT:U.RIGHT,UP:U.UP,DOWN:U.DOWN,RED:N.RED,GREEN:N.GREEN,BLUE:N.BLUE,YELLOW:N.YELLOW,MAGENTA:N.MAGENTA,CYAN:N.CYAN,WHITE:N.WHITE,BLACK:N.BLACK,quit:dr,Event:we,EventHandler:Ae,EventController:ge};if(e.plugins&&e.plugins.forEach(Pi),!1!==e.global)for(let R in mr)window[R]=mr[R];return!1!==e.focus&&h.canvas.focus(),mr}),"default")({global:!1,touchToMouse:!0,canvas:document.getElementById("game"),debug:!1}),Dt=Ct.width(),Ut=Ct.height(),Lt=Ct.width()/2,Nt=Ct.height()/2,Gt=3.5,Ot={computer:{uiBase:"ui-large",ui:"computer",uiClose:"computer-btn-close",content:{projects:[{name:"Portfolio",year:"2024",tags:["Web Dev","Portfolio","Game"],description:"This is the site you're on right now! The map was made using Tiled along with some public assets. The game mechanics were based on Kaboom.js tutorials. The UI was built with HTML, CSS, and JavaScript plus some components from a CSS library and a CSS framework. It's responsive so explore on either desktop or mobile!",links:[{host:"GitHub",link:"https://github.com/EricccD567/ericccd567.github.io"},{host:"Website",link:"https://ericccd567.github.io/"}]},{name:"Tuesday",year:"2022",tags:["Web Dev","UI/UX","Frontend","Backend","Database"],description:"Tuesday was my team's uni capstone project. It's a team task management system where users can add team members and create/assign tasks. Users are also able to view their peers' tasks and workload capacity scores to assist or reassign work. It has a self-reflection feature that provides daily analytical feedback and can personalise task order based on user tendencies, deadlines, and task dependencies. I was responsible for the UI/UX, some of the React.js frontend, and assisted with the Python backend.",links:[{host:"GitHub",link:"https://github.com/EricccD567/Tuesday"},{host:"Web App",link:"https://tuesday-0o2u.onrender.com/"}]},{name:"TimerQ",year:"2024",tags:["Web App","Frontend"],description:"TimerQ is a countdown timer queue that can manage multiple countdown timers in a queue, built with TypeScript and React.js. It provides a hands-free experience for users to streamline daily routines by automatically starting the next timer in the queue after the previous one ends. It also allows for real-time adjustments, including adding, deleting, and editing timers.",links:[{host:"GitHub",link:"https://github.com/EricccD567/timerq"},{host:"Website",link:"https://ericccd567.github.io/timerq/"}]},{name:"reset-css",year:"2024",tags:["Web Dev","CSS Reset"],description:"This is an opinionated CSS reset that deals with inconsistencies between different browsers' user-agent stylesheets as well as enhance developer experience. It improves the default readability of text, responsiveness of media elements, and performance. The reset's effects are highlighted in the website. Try it for your next project!",links:[{host:"GitHub",link:"https://github.com/EricccD567/reset-css"},{host:"Website",link:"https://ericccd567.github.io/reset-css/"}]},{name:"Git Cheatsheet",year:"2024",tags:["Git"],description:"A somewhat detailed reference of common Git commands. When I first started coding, I had a vague idea of how Git worked, but as I began using more advanced Git commands, I found myself wondering what the commands were actually doing. So I decided to research and test a bunch of commands to compile a cheatsheet for developers in similar situations. It clarifies Git's structure and processes without getting too in-depth.",links:[{host:"GitHub Gist",link:"https://gist.github.com/EricccD567/225755178caf24b04f7d2d1a38877120"}]},{name:"sheepy",year:"2023",tags:["Python","Dash","Transpiler"],description:"Sheepy is a basic Dash script to Python code transpiler. It is a Python script that takes in a Dash script as input, translating it line by line to valid Python code including indentation and imports, and prints the output to the command line.",links:[{host:"GitHub",link:"https://github.com/EricccD567/sheepy"}]},{name:"scroll-snap-effect",year:"2021",tags:["Web Dev","Effect"],description:"A simple scroll-snap page effect with buttons that use scrollTo to smoothly move to different sections of the page. I made this in HTML, CSS, and Javascript when I first started learning web development.",links:[{host:"GitHub",link:"https://github.com/EricccD567/scroll-snap-effect"},{host:"Website",link:"https://ericccd567.github.io/scroll-snap-effect/"}]},{name:"txt2report",year:"2024-",tags:["Development"],description:"An auto format report creator. It's curently in development so check back soon!",links:[]}],experience:[{name:"ac-redesign",year:"2021",tags:["UI/UX","Designer"],description:"Designed a modernised mockup of a desktop website homepage for a bicycle shop. Provided concepts for the shop owner based on design principles and usability heuristics.",links:[{host:"Figma",link:"https://www.figma.com/design/jt777EgXgY28iZ144aE2R8/ac-redesign?node-id=0-1&t=VtdPlgBP4CFNM11m-1"}]},{name:"Dreamway",year:"2019-2020",tags:["Tutor"],description:"Facilitated academic success in mathematics for students in years 7-12.",links:[{host:"Website",link:"https://dreamwayeducation.com.au/"}]},{name:"Project Prosthesis",year:"2018-2019",tags:["Co-Founder","Mechanical","Engineer","CAD","3D Printing"],description:"Founded the startup with my mentor to prototype and build cheap, modular prosthetic legs aimed at children in developing countries. This allows the children to adapt to growth and damage while improving gait. Two other members joined and we managed to build two prototypes using CAD and 3D printing.",links:[]},{name:"JEI",year:"2018-2019",tags:["Tutor"],description:"Taught year 4-9 students to build basic wheeled robots and introductory programming.",links:[{host:"Website",link:"https://au.jei.com/"}]}]}},resume:{uiBase:"ui-medium",ui:"resume",uiClose:"resume-btn-close",content:{}},skills:{uiBase:"ui-medium",ui:"skills",uiClose:"skills-btn-close",content:{technical:[{skill:"Git",level:9},{skill:"HTML",level:8},{skill:"CSS",level:8},{skill:"JavaScript",level:7},{skill:"Python",level:7},{skill:"Shell",level:7},{skill:"Figma",level:7},{skill:"TypeScript",level:6},{skill:"React.js",level:6}],soft:[{skill:"Learning",level:9},{skill:"Detailed",level:9},{skill:"Organisation",level:9},{skill:"Problem Solving",level:8},{skill:"Communication",level:8},{skill:"Teamwork",level:8}]}},degree:{uiBase:"ui-small",ui:"dialogue",uiClose:"dialogue-btn-close",content:{text:"I studied at The University of New South Wales (UNSW Sydney) from 2018 to 2024 with a dual bachelor's degree in Computer Science and Mechanical Engineering (Honours)."}},about:{uiBase:"ui-small",ui:"dialogue",uiClose:"dialogue-btn-close",content:{text:"Hi! I'm <strong>Eric Dai</strong>, a <strong>developer</strong> and <strong>engineer</strong>, based in <strong>Sydney, AU</strong>. I'm passionate about building cool things with technology, currently focused on full-stack development. Feel free to look around!"}},bag:{uiBase:"ui-small",ui:"dialogue",uiClose:"dialogue-btn-close",content:{text:"A pair of running shoes and boxing gloves..."}},food:{uiBase:"ui-small",ui:"dialogue",uiClose:"dialogue-btn-close",content:{text:"Eggs, chicken, tuna, rice, yogurt, melon, leftover pizza..."}},music:{uiBase:"ui-small",ui:"dialogue",uiClose:"dialogue-btn-close",content:{text:'I enjoy lo-fi and bedroom pop. I\'m learning music production and if I ever make something cool I\'ll post it to my <a href="https://soundcloud.com/nopei" target="_blank" rel="noopener noreferrer">SoundCloud</a>. Stay tuned!'}},art:{uiBase:"ui-small",ui:"dialogue",uiClose:"dialogue-btn-close",content:{text:"Coming soon!"}}},qt=Ct.color(2,0,53),Ht=Ct.color(125,206,235);function jt(e,t){if("console"===e)return;const n=Ot[e],i=document.getElementById(n.uiBase);i.classList.remove("hidden");const r=document.getElementById(n.ui);"computer"!==e&&r.classList.remove("hidden");const s=document.getElementById(n.uiClose);let o=()=>{};switch(e){case"computer":{const e=document.getElementById("boot");e.classList.remove("hidden");const t=document.getElementById("progress-bar"),i=setInterval((()=>{const n=parseInt(t.getAttribute("value"));n<100?t.setAttribute("value",(n+1).toString()):(e.classList.add("hidden"),t.setAttribute("value","0"),r.classList.remove("hidden"),clearInterval(i))}),7),s=document.getElementById("computer-menu-desktop"),a=document.getElementById("computer-menu-mobile"),l=window.matchMedia("(min-width: 30em)"),h=e=>{e.matches?(s.classList.remove("hidden"),a.classList.add("hidden")):(s.classList.add("hidden"),a.classList.remove("hidden"))};h(l);const u=e=>{h(e)};l.addEventListener("change",u);const d=document.getElementById("menu-desktop-projects"),c=document.getElementById("menu-desktop-experience"),p=document.getElementById("menu-mobile-projects"),f=document.getElementById("menu-mobile-experience"),m=document.getElementById("projects-content"),g=document.getElementById("experience-content"),w=()=>{m.style.zIndex="2",g.style.zIndex="1"},A=()=>{m.style.zIndex="1",g.style.zIndex="2"};d.addEventListener("click",w),p.addEventListener("click",w),c.addEventListener("click",A),f.addEventListener("click",A);const v=n.content.projects,y=n.content.experience,V=v.length,x=document.getElementById("projects-count");x.innerText=V.toString();const E=y.length,b=document.getElementById("experience-count");b.innerText=E.toString();const S=e=>e.reduce(((e,t)=>e+=`\n            <div\n              style="\n                margin-bottom: 2rem;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n              "\n            >\n              <h2\n                style="\n                  font-size: clamp(1.5rem, 3vw, 2.5rem);\n                  text-align: center;\n                "\n              >\n                ${t.name}\n              </h2>\n              <p style="font-size: clamp(0.9rem, 1.8vw, 1.5rem)">\n                <strong>${t.year}</strong>\n              </p>\n              <div\n                style="\n                  font-size: clamp(0.5rem, 1vw, 0.8rem);\n                  margin-bottom: 0.5rem;\n                  display: flex;\n                  flex-wrap: wrap;\n                  justify-content: center;\n                  gap: 0.2rem 0.8rem;\n                "\n              >\n                ${t.tags.reduce(((e,t)=>e+=`\n              <a class="nes-badge" style="cursor: default">\n                <span class="is-dark">${t}</span>\n              </a>\n            `),"")}\n              </div>\n              <p\n                style="\n                  font-size: clamp(0.9rem, 1.8vw, 1.5rem);\n                  margin-bottom: 0.5rem;\n                  max-width: 70ch;\n                "\n              >\n                ${t.description}\n              </p>\n              ${t.links.reduce(((e,t)=>{const n=t.host;return e+=`\n              <a\n                href="${t.link}"\n                target="_blank"\n                rel="noopener noreferrer"\n                style="\n                  cursor: pointer;\n                  font-size: clamp(0.9rem, 1.8vw, 1.5rem);\n                  color: inherit;\n                  text-decoration: underline #212529 solid 2px !important;\n                  margin-bottom: 6px;\n                "\n              >\n                ${n}\n              </a>\n            `}),"")}\n            </div>\n          `),""),R=document.getElementById("projects");R.innerHTML=S(v);const M=document.getElementById("experience");M.innerHTML=S(y),o=()=>{l.removeEventListener("change",u),d.removeEventListener("click",w),p.removeEventListener("click",w),c.removeEventListener("click",A),f.removeEventListener("click",A),x.innerText="",b.innerText="",R.innerHTML="",M.innerHTML=""};break}case"resume":break;case"skills":{const e=n.content.technical,t=n.content.soft,i=window.matchMedia("(min-width: 55em)"),r=(e,t)=>{let n="";return n=t.matches?e.reduce(((e,t)=>{const n=t.skill;let i="",r="",s="",o="",a="";switch(t.level){case 0:i="is-transparent",r="is-transparent",s="is-transparent",o="is-transparent",a="is-transparent";break;case 1:i="is-half",r="is-transparent",s="is-transparent",o="is-transparent",a="is-transparent";break;case 2:r="is-transparent",s="is-transparent",o="is-transparent",a="is-transparent";break;case 3:r="is-half",s="is-transparent",o="is-transparent",a="is-transparent";break;case 4:s="is-transparent",o="is-transparent",a="is-transparent";break;case 5:s="is-half",o="is-transparent",a="is-transparent";break;case 6:o="is-transparent",a="is-transparent";break;case 7:o="is-half",a="is-transparent";break;case 8:a="is-transparent";break;case 9:a="is-half"}return e+=`\n              <div\n                style="\n                  margin-bottom: 1rem;\n                  width: 100%;\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: center;\n                "\n              >\n                <p class="ui-text" style="font-size: 2.5rem">${n}</p>\n                <div>\n                  <i class="nes-icon is-medium star ${i}"></i>\n                  <i class="nes-icon is-medium star ${r}"></i>\n                  <i class="nes-icon is-medium star ${s}"></i>\n                  <i class="nes-icon is-medium star ${o}"></i>\n                  <i class="nes-icon is-medium star ${a}"></i>\n                </div>\n              </div>\n            `}),""):e.reduce(((e,t)=>e+=`\n              <div\n                style="\n                  margin-bottom: 0.25rem;\n                  width: 100%;\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: center;\n                "\n              >\n                <p\n                  class="ui-text"\n                  style="font-size: clamp(1.4rem, 4vw, 2.5rem)"\n                >\n                  ${t.skill}\n                </p>\n                <div\n                  style="\n                    margin-left: 1rem;\n                    margin-right: 0.5rem;\n                    display: flex;\n                    justify-content: flex-end;\n                    align-items: center;\n                    gap: 0 0.3rem;\n                  "\n                >\n                  <p\n                    class="ui-text"\n                    style="font-size: clamp(1.4rem, 4vw, 2.5rem)"\n                  >\n                    ${t.level/2}\n                  </p>\n                  <i\n                    class="nes-icon is-medium star"\n                    style="transform: scale(1.75); margin-right: 0"\n                  ></i>\n                </div>\n              </div>\n            `),""),n},s=document.getElementById("tech-skills-heading"),a=document.getElementById("soft-skills-heading"),l=n=>{s.insertAdjacentHTML("afterend",r(e,n)),a.insertAdjacentHTML("afterend",r(t,n))};l(i);const h=()=>{document.querySelectorAll("#skills-content > div").forEach((e=>{e.parentNode.removeChild(e)}))},u=e=>{h(),l(e)};i.addEventListener("change",u),o=()=>{i.removeEventListener("change",u),h()};break}case"degree":case"about":case"bag":case"food":case"music":case"art":{const e=n.content.text,t=e.length,i=document.getElementById("dialogue-content");let r=0,s="";const a=setInterval((()=>{if(r<t){let n=e[r];if("<"===n){const o=r++;let a=0;for(;r<t&&(n=e[r],">"!==n||(a++,2!==a));r++);s+=e.slice(o,r),i.innerHTML=s}else s+=n,i.innerHTML=s,r++}else clearInterval(a)}),25);o=()=>{i.innerHTML="",clearInterval(a)};break}}s.addEventListener("click",(function e(){o(),s.removeEventListener("click",e),r.classList.add("hidden"),i.classList.add("hidden"),t()})),addEventListener("keypress",(e=>{"Enter"===e.code&&s.click()}))}function Kt(e,t){const n="right"===t||"left"===t?"side":t;e.curAnim()!==`walk-${n}`&&e.play(`walk-${n}`),e.direction=t}function Yt(e){e.width()/e.height()<1?e.camScale(e.vec2(1)):e.camScale(e.vec2(1.5))}function zt(e){function t(){Ct.setCursor("url(./cursor-default.png), auto"),Ct.setGravity(0),Ct.go("main",e)}Ct.add([Ct.sprite("bg",{width:Dt,height:Ut}),Ct.area({shape:new Ct.Rect(Ct.vec2(0),Dt,Ut-150)}),Ct.opacity(1),Ct.fadeIn(1),"bg"]),Ct.add([Ct.sprite("btn-close"),Ct.scale(.5),Ct.area({cursor:"url(./cursor-pointer.png), auto"}),Ct.anchor("center"),Ct.pos(Lt,Ut-100),Ct.opacity(1),Ct.fadeIn(.5),"close"]),Ct.onClick("bg",(()=>{Ct.go("game",e)})),Ct.onKeyPress("space",(()=>{Ct.go("game",e)})),Ct.onHoverEnd("close",(()=>{Ct.setCursor("url(./cursor-default.png), auto")})),Ct.onClick("close",(()=>{t()})),Ct.onKeyPress("enter",(()=>{t()}))}Ct.setCursor("url(./cursor-default.png), auto"),Ct.loadSprite("player","./spritesheet-player.png",{sliceX:4,sliceY:6,anims:{"idle-down":{from:0,to:3,loop:!0,speed:7},"idle-up":{from:4,to:7,loop:!0,speed:7},"idle-side":{from:8,to:11,loop:!0,speed:7},"walk-down":{from:12,to:15,loop:!0,speed:7},"walk-up":{from:16,to:19,loop:!0,speed:7},"walk-side":{from:20,to:23,loop:!0,speed:7}}}),Ct.loadSprite("map","./map.png"),Ct.loadSprite("roof","./roof.png"),Ct.setBackground(Ct.Color.fromHex("#112211")),Ct.scene("main",(async e=>{const t=document.getElementById("ui-start");if(!t.classList.contains("hidden")){let e=function(){t.classList.add("hidden"),n.removeEventListener("click",e)};const n=document.getElementById("start-btn");n.addEventListener("click",e),addEventListener("keypress",(e=>{"Enter"===e.code&&n.click()}))}const n=(await(await fetch("./map.json")).json()).layers,i=Ct.add([Ct.sprite("map"),Ct.pos(0),Ct.scale(Gt)]),r=Ct.make([Ct.sprite("player",{anim:"idle-down"}),Ct.anchor("center"),Ct.area({shape:new Ct.Rect(Ct.vec2(0,4),9,10)}),Ct.body(),Ct.pos(),Ct.scale(Gt),{speed:250,direction:"down",isInUI:!1},"player"]),s=Ct.make([Ct.sprite("roof"),Ct.pos(0),Ct.scale(Gt),Ct.opacity(0)]);function o(){"down"===r.direction?r.play("idle-down"):"up"===r.direction?r.play("idle-up"):r.play("idle-side")}for(const a of n)if("boundaries"!==a.name){if("spawnpoints"===a.name)for(const t of a.objects)"player"!==t.name||(-1===e.x&&-1===e.y?r.pos=Ct.vec2((i.pos.x+t.x)*Gt,(i.pos.y+t.y)*Gt):r.pos=Ct.vec2(e.x,e.y),Ct.add(r))}else for(const e of a.objects){if(Object.hasOwn(e,"polygon")){const t=e.polygon.map((e=>Ct.vec2(e.x,e.y)));i.add([Ct.area({shape:new Ct.Polygon(t)}),Ct.body({isStatic:!0}),Ct.pos(e.x,e.y),e.name,e.type])}else i.add([Ct.area({shape:new Ct.Rect(Ct.vec2(0),e.width,e.height)}),Ct.body({isStatic:!0}),Ct.pos(e.x,e.y),e.name,e.type]);"interactive"===e.type&&r.onCollide(e.name,(()=>{"console"!==e.name?(r.speed=0,r.isInUI=!0,o(),jt(e.name,(()=>{r.isInUI=!1}))):Ct.go("gamestart",{x:r.pos.x+35,y:r.pos.y})}))}Ct.add(s),Yt(Ct),Ct.onResize((()=>{Yt(Ct)})),Ct.onUpdate((()=>{Ct.camPos(r.pos.x,r.pos.y+75);const e=r.pos.x/Gt,t=r.pos.y/Gt;s.opacity=e>176&&e<298&&t>72&&t<185||e>=144&&e<=176&&t>120&&t<152||e>53&&e<144&&t>105&&t<168?0:1})),Ct.onMousePress((e=>{"left"!==e||r.isInUI||(r.speed=250)})),Ct.onMouseDown((e=>{if("left"!==e||r.isInUI||0===r.speed)return;const t=Ct.toWorld(Ct.mousePos());r.moveTo(t,r.speed);const n=r.pos.angle(t);if(n>50&&n<130)Kt(r,"up");else{if(!(n<-50&&n>-130))return Math.abs(n)>130?(r.flipX=!1,void Kt(r,"right")):Math.abs(n)<50?(r.flipX=!0,void Kt(r,"left")):void 0;Kt(r,"down")}})),Ct.onKeyDown((e=>{if(r.isInUI)return;if(Ct.isKeyDown("enter"))return;if(Ct.isMouseDown("left"))return;r.speed=250;const t=[Ct.isKeyDown("up"),Ct.isKeyDown("down"),Ct.isKeyDown("right"),Ct.isKeyDown("left")];return t.reduce(((e,t)=>(t&&e++,e)),0)>1?void 0:t[0]?(Kt(r,"up"),void r.move(0,-r.speed)):t[1]?(Kt(r,"down"),void r.move(0,r.speed)):t[2]?(r.flipX=!1,Kt(r,"right"),void r.move(r.speed,0)):t[3]?(r.flipX=!0,Kt(r,"left"),void r.move(-r.speed,0)):void 0})),Ct.onMouseRelease(o),Ct.onKeyRelease(o)})),Ct.go("main",{x:-1,y:-1}),Ct.loadSprite("bg","./console/bg.png"),Ct.loadSprite("boundman","./console/boundman.png"),Ct.loadSprite("pipe","./console/pipe.png"),Ct.loadSound("bounce","./console/bounce.mp3"),Ct.loadSprite("btn-close","./console/btn-close.png"),Ct.scene("gamestart",(e=>{zt(e),Ct.add([Ct.text("Space/Click/Tap to Jump\n\nSpace/Click/Tap to Start",{font:"monogram",size:32}),qt,Ct.anchor("center"),Ct.pos(Lt,Nt),Ct.opacity(1),Ct.fadeIn(.5)])}));let Qt=0;Ct.scene("game",(e=>{let t=0;Ct.add([Ct.sprite("bg",{width:Dt,height:Ut})]),Ct.setGravity(2e3);const n=Ct.add([Ct.sprite("boundman"),Ct.scale(.5),Ct.area(),Ct.body(),Ct.anchor("center"),Ct.pos(Lt/2,Nt)]);Ct.loop(3,(()=>{!function(){const e=Ct.rand(-75,75);Ct.add([Ct.sprite("pipe"),Ct.scale(2),Ht,Ct.area(),Ct.pos(Dt,Nt+e+125),{passed:!1},"pipe"]),Ct.add([Ct.sprite("pipe",{flipY:!0}),Ct.scale(2),Ht,Ct.area(),Ct.anchor("botleft"),Ct.pos(Dt,Nt+e-125),"pipe"])}()}));const i=Ct.add([Ct.text(t,{font:"monogram",size:100}),qt,Ct.pos(25,0)]);function r(){Ct.play("bounce"),n.jump(650)}Ct.onUpdate("pipe",(e=>{e.move(-150,0),!1===e.passed&&n.pos.x>e.pos.x&&(e.passed=!0,t+=1,i.text=t)})),n.onCollide("pipe",(()=>{Ct.go("gameover",t,e)})),n.onUpdate((()=>{(n.pos.y>Ut+25||n.pos.y<-25)&&Ct.go("gameover",t,e)})),Ct.onKeyPress("space",(()=>{r()})),Ct.onMousePress((e=>{"left"===e&&r()}))})),Ct.scene("gameover",((e,t)=>{e>Qt&&(Qt=e),zt(t),Ct.add([Ct.text(`Game Over!\nScore: ${e}\nHigh Score: ${Qt}\n\nSpace/Click/Tap to Restart`,{font:"monogram",size:32}),qt,Ct.anchor("center"),Ct.pos(Lt,Nt)])}));
